/*!
 *  dc 4.2.7
 *  http://dc-js.github.io/dc.js/
 *  Copyright 2012-2021 Nick Zhu & the dc.js Developers
 *  https://github.com/dc-js/dc.js/blob/master/AUTHORS
 *
 *  Licensed under the Apache License, Version 2.0 (the "License");
 *  you may not use this file except in compliance with the License.
 *  You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 *  Unless required by applicable law or agreed to in writing, software
 *  distributed under the License is distributed on an "AS IS" BASIS,
 *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 *  See the License for the specific language governing permissions and
 *  limitations under the License.
 */

!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("d3"),require("d3"),require("d3"),require("d3"),require("d3"),require("d3"),require("d3"),require("d3"),require("d3"),require("d3"),require("d3"),require("d3"),require("d3"),require("d3"),require("d3"),require("d3"),require("d3"),require("d3"),require("d3")):"function"==typeof define&&define.amd?define(["exports","d3","d3","d3","d3","d3","d3","d3","d3","d3","d3","d3","d3","d3","d3","d3","d3","d3","d3","d3"],e):e((t=t||self).dc={},t.d3,t.d3,t.d3,t.d3,t.d3,t.d3,t.d3,t.d3,t.d3,t.d3,t.d3,t.d3,t.d3,t.d3,t.d3,t.d3,t.d3,t.d3,t.d3)}(this,(function(t,e,i,s,r,n,a,h,l,o,c,d,_,u,g,p,y,m,x,f){"use strict";class b extends Error{}const A={CHART_CLASS:"dc-chart",DEBUG_GROUP_CLASS:"debug",STACK_CLASS:"stack",DESELECTED_CLASS:"deselected",SELECTED_CLASS:"selected",NODE_INDEX_NAME:"__index__",GROUP_INDEX_NAME:"__group_index__",DEFAULT_CHART_GROUP:"__default_chart_group__",EVENT_DELAY:40,NEGLIGIBLE_NUMBER:1e-10};class v{constructor(){this.enableDebugLog=!1,this._alreadyWarned={}}warn(t){return console&&(console.warn?console.warn(t):console.log&&console.log(t)),this}warnOnce(t){return this._alreadyWarned[t]||(this._alreadyWarned[t]=!0,C.warn(t)),this}debug(t){return this.enableDebugLog&&console&&(console.debug?console.debug(t):console.log&&console.log(t)),this}}const C=new v;class k{constructor(){this._defaultColors=k._schemeCategory20c,this.dateFormat=e.timeFormat("%m/%d/%Y"),this._renderlet=null,this.disableTransitions=!1}defaultColors(t){return arguments.length?(this._defaultColors=t,this):(this._defaultColors===k._schemeCategory20c&&C.warnOnce("You are using d3.schemeCategory20c, which has been removed in D3v5. See the explanation at https://github.com/d3/d3/blob/master/CHANGES.md#changes-in-d3-50. DC is using it for backward compatibility, however it will be changed in DCv3.1. You can change it by calling dc.config.defaultColors(newScheme). See https://github.com/d3/d3-scale-chromatic for some alternatives."),this._defaultColors)}}k._schemeCategory20c=["#3182bd","#6baed6","#9ecae1","#c6dbef","#e6550d","#fd8d3c","#fdae6b","#fdd0a2","#31a354","#74c476","#a1d99b","#c7e9c0","#756bb1","#9e9ac8","#bcbddc","#dadaeb","#636363","#969696","#bdbdbd","#d9d9d9"];const S=new k,w={eventHandler:t=>function(e,i){console.warn("No d3.js compatbility event handler registered, defaulting to v6 behavior."),t.call(this,i,e)},nester:({key:t,sortKeys:e,sortValues:i,entries:s})=>{throw new Error("No d3.js compatbility nester registered, load v5 or v6 compability layer.")},pointer:()=>{throw new Error("No d3.js compatbility pointer registered, load v5 or v6 compability layer.")}};const L=new class{constructor(){this._chartMap={}}_initializeChartGroup(t){return t||(t=A.DEFAULT_CHART_GROUP),this._chartMap[t]||(this._chartMap[t]=[]),t}has(t){for(const e in this._chartMap)if(this._chartMap[e].indexOf(t)>=0)return!0;return!1}register(t,e){this._chartMap[e=this._initializeChartGroup(e)].push(t)}deregister(t,e){e=this._initializeChartGroup(e);for(let i=0;i<this._chartMap[e].length;i++)if(this._chartMap[e][i].anchorName()===t.anchorName()){this._chartMap[e].splice(i,1);break}}clear(t){t?delete this._chartMap[t]:this._chartMap={}}list(t){return t=this._initializeChartGroup(t),this._chartMap[t]}},R=function(t,e){L.register(t,e)},D=function(t,e){L.deregister(t,e)},O=function(t){const e=L.list(t);for(let t=0;t<e.length;++t)e[t].render();null!==S._renderlet&&S._renderlet(t)},B=function(t){const e=L.list(t);for(let t=0;t<e.length;++t)e[t].redraw();null!==S._renderlet&&S._renderlet(t)},F=function(t,e,i,s){if(S.disableTransitions||e<=0)return t;let r=t.transition(s);return(e>=0||void 0!==e)&&(r=r.duration(e)),(i>=0||void 0!==i)&&(r=r.delay(i)),r},P=function(t,e,i,s){return t?function(t){return F(t,e,i,s)}:function(t){return t}},H=function(t){return t instanceof Object&&t.__dcFlag__&&!0},T={current:null,trigger:function(t,e){e?(T.current=t,setTimeout((()=>{t===T.current&&t()}),e)):t()}},E={RangedFilter:function(t,e){const i=new Array(t,e);return i.isFiltered=function(t){return t>=this[0]&&t<this[1]},i.filterType="RangedFilter",i},TwoDimensionalFilter:function(t){if(null===t)return null;const e=t;return e.isFiltered=function(t){return t.length&&t.length===e.length&&t[0]===e[0]&&t[1]===e[1]},e.filterType="TwoDimensionalFilter",e},RangedTwoDimensionalFilter:function(t){if(null===t)return null;const e=t;let i;return i=e[0]instanceof Array?[[Math.min(t[0][0],t[1][0]),Math.min(t[0][1],t[1][1])],[Math.max(t[0][0],t[1][0]),Math.max(t[0][1],t[1][1])]]:[[t[0],-1/0],[t[1],1/0]],e.isFiltered=function(t){let e,s;return t instanceof Array?(e=t[0],s=t[1]):(e=t,s=i[0][1]),e>=i[0][0]&&e<i[1][0]&&s>=i[0][1]&&s<i[1][1]},e.filterType="RangedTwoDimensionalFilter",e},HierarchyFilter:function(t){if(null===t)return null;const e=t.slice(0);return e.isFiltered=function(t){if(!(e.length&&t&&t.length&&t.length>=e.length))return!1;for(let i=0;i<e.length;i++)if(t[i]!==e[i])return!1;return!0},e}};class z extends Error{}const M=function(t,e){return e?function(i,s){return e.call(i,i[t],s)}:function(e){return e[t]}},N={printSingleValue:function(t){let e=""+t;return t instanceof Date?e=S.dateFormat(t):"string"==typeof t?e=t:N.isFloat(t)?e=N.printSingleValue.fformat(t):N.isInteger(t)&&(e=Math.round(t)),e}};N.printSingleValue.fformat=s.format(".2f"),N._toTimeFunc=function(t){return{second:i.timeSecond,minute:i.timeMinute,hour:i.timeHour,day:i.timeDay,week:i.timeWeek,month:i.timeMonth,year:i.timeYear}[t]},N.add=function(t,e,s){if("string"==typeof e&&(e=e.replace("%","")),t instanceof Date)return"string"==typeof e&&(e=+e),"millis"===s?new Date(t.getTime()+e):("function"!=typeof(s=s||i.timeDay)&&(s=N._toTimeFunc(s)),s.offset(t,e));if("string"==typeof e){const i=+e/100;return t>0?t*(1+i):t*(1-i)}return t+e},N.subtract=function(t,e,s){if("string"==typeof e&&(e=e.replace("%","")),t instanceof Date)return"string"==typeof e&&(e=+e),"millis"===s?new Date(t.getTime()-e):("function"!=typeof(s=s||i.timeDay)&&(s=N._toTimeFunc(s)),s.offset(t,-e));if("string"==typeof e){const i=+e/100;return t<0?t*(1+i):t*(1-i)}return t-e},N.isNumber=function(t){return t===+t},N.isFloat=function(t){return t===+t&&t!==(0|t)},N.isInteger=function(t){return t===+t&&t===(0|t)},N.isNegligible=function(t){return!N.isNumber(t)||t<A.NEGLIGIBLE_NUMBER&&t>-A.NEGLIGIBLE_NUMBER},N.clamp=function(t,e,i){return t<e?e:t>i?i:t},N.constant=function(t){return function(){return t}};let G=0;function $(t,e){for(let i=0;i<t.length;i++)if(t[i].key===e)return t[i]}N.uniqueId=function(){return++G},N.nameToId=function(t){return t.toLowerCase().replace(/[\s]/g,"_").replace(/[\.']/g,"")},N.appendOrSelect=function(t,e,i){i=i||e;let s=t.select(e);return s.empty()&&(s=t.append(i)),s},N.safeNumber=function(t){return N.isNumber(+t)?+t:0},N.arraysEqual=function(t,e){return!t&&!e||!(!t||!e)&&(t.length===e.length&&t.every(((t,i)=>t.valueOf()===e[i].valueOf())))},N.allChildren=function(t){let e=[];if(e.push(t.path),console.log("currentNode",t),t.children)for(let i=0;i<t.children.length;i++)e=e.concat(N.allChildren(t.children[i]));return e},N.toHierarchy=function(t,e){const i={key:"root",children:[]};for(let s=0;s<t.length;s++){const r=t[s],n=r.key,a=e(r);let h=i;for(let t=0;t<n.length;t++){const e=n.slice(0,t+1),i=h.children,s=n[t];let l;t+1<n.length?(l=$(i,s),void 0===l&&(l={key:s,children:[],path:e},i.push(l)),h=l):(l={key:s,value:a,data:r,path:e},i.push(l))}}return i},N.getAncestors=function(t){const e=[];let i=t;for(;i.parent;)e.unshift(i.name),i=i.parent;return e},N.arraysIdentical=function(t,e){let i=t.length;if(i!==e.length)return!1;for(;i--;)if(t[i]!==e[i])return!1;return!0};const Y={filters:function(t){let e="";for(let i=0;i<t.length;++i)i>0&&(e+=", "),e+=Y.filter(t[i]);return e},filter:function(t){let e="";return null!=t&&(t instanceof Array?t.length>=2?e=`[${t.map((t=>N.printSingleValue(t))).join(" -> ")}]`:t.length>=1&&(e=N.printSingleValue(t[0])):e=N.printSingleValue(t)),e}},V={integers:function(t,e){return Math.abs(e-t)},ordinal:function(){throw new Error("dc.units.ordinal should not be called - it is a placeholder")},fp:{}};V.fp.precision=function(t){const e=function(t,i){const s=Math.abs((i-t)/e.resolution);return N.isNegligible(s-Math.floor(s))?Math.floor(s):Math.ceil(s)};return e.resolution=t,e};const I=(t,e)=>(0===e.length?t.filter(null):1!==e.length||e[0].isFiltered?1===e.length&&"RangedFilter"===e[0].filterType?t.filterRange(e[0]):t.filterFunction((t=>{for(let i=0;i<e.length;i++){const s=e[i];if(s.isFiltered){if(s.isFiltered(t))return!0}else if(s<=t&&s>=t)return!0}return!1})):t.filterExact(e[0]),e),W=(t,e)=>null==e?t.length>0:t.some((t=>e<=t&&e>=t)),U=(t,e)=>{for(let i=0;i<t.length;i++)if(t[i]<=e&&t[i]>=e){t.splice(i,1);break}return t},X=(t,e)=>(t.push(e),t),q=t=>[];class j{constructor(){this.__dcFlag__=N.uniqueId(),this._svgDescription=null,this._keyboardAccessible=!1,this._dimension=void 0,this._group=void 0,this._anchor=void 0,this._root=void 0,this._svg=void 0,this._isChild=void 0,this._minWidth=200,this._defaultWidthCalc=t=>{const e=t&&t.getBoundingClientRect&&t.getBoundingClientRect().width;return e&&e>this._minWidth?e:this._minWidth},this._widthCalc=this._defaultWidthCalc,this._minHeight=200,this._defaultHeightCalc=t=>{const e=t&&t.getBoundingClientRect&&t.getBoundingClientRect().height;return e&&e>this._minHeight?e:this._minHeight},this._heightCalc=this._defaultHeightCalc,this._width=void 0,this._height=void 0,this._useViewBoxResizing=!1,this._keyAccessor=M("key"),this._valueAccessor=M("value"),this._label=M("key"),this._ordering=M("key"),this._renderLabel=!1,this._title=t=>`${this.keyAccessor()(t)}: ${this.valueAccessor()(t)}`,this._renderTitle=!0,this._controlsUseVisibility=!1,this._transitionDuration=750,this._transitionDelay=0,this._filterPrinter=Y.filters,this._mandatoryAttributesList=["dimension","group"],this._chartGroup=A.DEFAULT_CHART_GROUP,this._listeners=n.dispatch("preRender","postRender","preRedraw","postRedraw","filtered","zoomed","renderlet","pretransition"),this._legend=void 0,this._commitHandler=void 0,this._defaultData=t=>t.all(),this._data=this._defaultData,this._filters=[],this._filterHandler=I,this._hasFilterHandler=W,this._removeFilterHandler=U,this._addFilterHandler=X,this._resetFilterHandler=q}height(t){return arguments.length?(this._heightCalc=t?"function"==typeof t?t:N.constant(t):this._defaultHeightCalc,this._height=void 0,this):(N.isNumber(this._height)||(this._height=this._heightCalc(this._root.node())),this._height)}width(t){return arguments.length?(this._widthCalc=t?"function"==typeof t?t:N.constant(t):this._defaultWidthCalc,this._width=void 0,this):(N.isNumber(this._width)||(this._width=this._widthCalc(this._root.node())),this._width)}minWidth(t){return arguments.length?(this._minWidth=t,this):this._minWidth}minHeight(t){return arguments.length?(this._minHeight=t,this):this._minHeight}useViewBoxResizing(t){return arguments.length?(this._useViewBoxResizing=t,this):this._useViewBoxResizing}dimension(t){return arguments.length?(this._dimension=t,this.expireCache(),this):this._dimension}data(t){return arguments.length?(this._data="function"==typeof t?t:N.constant(t),this.expireCache(),this):this._data(this._group)}group(t,e){return arguments.length?(this._group=t,this._groupName=e,this.expireCache(),this):this._group}ordering(t){return arguments.length?(this._ordering=t,this.expireCache(),this):this._ordering}_computeOrderedGroups(t){return Array.from(t).sort(((t,e)=>a.ascending(this._ordering(t),this._ordering(e))))}filterAll(){return this.filter(null)}select(t){return this._root.select(t)}selectAll(t){return this._root?this._root.selectAll(t):null}anchor(t,e){if(!arguments.length)return this._anchor;if(H(t))this._anchor=t.anchor(),this._anchor.children&&(this._anchor="#"+t.anchorName()),this._root=t.root(),this._isChild=!0;else{if(!t)throw new b("parent must be defined");t.select&&t.classed?this._anchor=t.node():this._anchor=t,this._root=r.select(this._anchor),this._root.classed(A.CHART_CLASS,!0),R(this,e),this._isChild=!1}return this._chartGroup=e,this}anchorName(){const t=this.anchor();return t&&t.id?t.id:t&&t.replace?t.replace("#",""):"dc-chart"+this.chartID()}root(t){return arguments.length?(this._root=t,this):this._root}svg(t){return arguments.length?(this._svg=t,this):this._svg}resetSvg(){return this.select("svg").remove(),this.generateSvg()}sizeSvg(){this._svg&&(this._useViewBoxResizing?this._svg.attr("viewBox")||this._svg.attr("viewBox",`0 0 ${this.width()} ${this.height()}`):this._svg.attr("width",this.width()).attr("height",this.height()))}generateSvg(){return this._svg=this.root().append("svg"),(this._svgDescription||this._keyboardAccessible)&&(this._svg.append("desc").attr("id","desc-id-"+this.__dcFlag__).html(""+this.svgDescription()),this._svg.attr("tabindex","0").attr("role","img").attr("aria-labelledby","desc-id-"+this.__dcFlag__)),this.sizeSvg(),this._svg}svgDescription(t){return arguments.length?(this._svgDescription=t,this):this._svgDescription||this.constructor.name}keyboardAccessible(t){return arguments.length?(this._keyboardAccessible=t,this):this._keyboardAccessible}filterPrinter(t){return arguments.length?(this._filterPrinter=t,this):this._filterPrinter}controlsUseVisibility(t){return arguments.length?(this._controlsUseVisibility=t,this):this._controlsUseVisibility}turnOnControls(){if(this._root){const t=this.controlsUseVisibility()?"visibility":"display";this.selectAll(".reset").style(t,null),this.selectAll(".filter").text(this._filterPrinter(this.filters())).style(t,null)}return this}turnOffControls(){if(this._root){const t=this.controlsUseVisibility()?"visibility":"display",e=this.controlsUseVisibility()?"hidden":"none";this.selectAll(".reset").style(t,e),this.selectAll(".filter").style(t,e).text(this.filter())}return this}transitionDuration(t){return arguments.length?(this._transitionDuration=t,this):this._transitionDuration}transitionDelay(t){return arguments.length?(this._transitionDelay=t,this):this._transitionDelay}_mandatoryAttributes(t){return arguments.length?(this._mandatoryAttributesList=t,this):this._mandatoryAttributesList}checkForMandatoryAttributes(t){if(!this[t]||!this[t]())throw new z(`Mandatory attribute chart.${t} is missing on chart[#${this.anchorName()}]`)}render(){this._height=this._width=void 0,this._listeners.call("preRender",this,this),this._mandatoryAttributesList&&this._mandatoryAttributesList.forEach((t=>this.checkForMandatoryAttributes(t)));const t=this._doRender();return this._legend&&this._legend.render(),this._activateRenderlets("postRender"),t}_makeKeyboardAccessible(t,...e){const i=this._svg.selectAll(".dc-tabbable").attr("tabindex",0);t&&i.on("keydown",w.eventHandler(((i,s)=>{13===s.keyCode&&"object"==typeof i&&t.call(this,i,...e),32===s.keyCode&&"object"==typeof i&&(t.call(this,i,...e),s.preventDefault())})))}_activateRenderlets(t){this._listeners.call("pretransition",this,this),this.transitionDuration()>0&&this._svg?this._svg.transition().duration(this.transitionDuration()).delay(this.transitionDelay()).on("end",(()=>{this._listeners.call("renderlet",this,this),t&&this._listeners.call(t,this,this)})):(this._listeners.call("renderlet",this,this),t&&this._listeners.call(t,this,this))}redraw(){this.sizeSvg(),this._listeners.call("preRedraw",this,this);const t=this._doRedraw();return this._legend&&this._legend.render(),this._activateRenderlets("postRedraw"),t}commitHandler(t){return arguments.length?(this._commitHandler=t,this):this._commitHandler}redrawGroup(){return this._commitHandler?this._commitHandler(!1,((t,e)=>{t?console.log(t):B(this.chartGroup())})):B(this.chartGroup()),this}renderGroup(){return this._commitHandler?this._commitHandler(!1,((t,e)=>{t?console.log(t):O(this.chartGroup())})):O(this.chartGroup()),this}_invokeFilteredListener(t){void 0!==t&&this._listeners.call("filtered",this,this,t)}_invokeZoomedListener(){this._listeners.call("zoomed",this,this)}hasFilterHandler(t){return arguments.length?(this._hasFilterHandler=t,this):this._hasFilterHandler}hasFilter(t){return this._hasFilterHandler(this._filters,t)}removeFilterHandler(t){return arguments.length?(this._removeFilterHandler=t,this):this._removeFilterHandler}addFilterHandler(t){return arguments.length?(this._addFilterHandler=t,this):this._addFilterHandler}resetFilterHandler(t){return arguments.length?(this._resetFilterHandler=t,this):this._resetFilterHandler}applyFilters(t){if(this.dimension()&&this.dimension().filter){const e=this._filterHandler(this.dimension(),t);e&&(t=e)}return t}replaceFilter(t){return this._filters=this._resetFilterHandler(this._filters),this.filter(t),this}filter(t){if(!arguments.length)return this._filters.length>0?this._filters[0]:null;let e=this._filters;return t instanceof Array&&t[0]instanceof Array&&!t.isFiltered?t[0].forEach((t=>{e=this._hasFilterHandler(e,t)?this._removeFilterHandler(e,t):this._addFilterHandler(e,t)})):e=null===t?this._resetFilterHandler(e):this._hasFilterHandler(e,t)?this._removeFilterHandler(e,t):this._addFilterHandler(e,t),this._filters=this.applyFilters(e),this._invokeFilteredListener(t),null!==this._root&&this.hasFilter()?this.turnOnControls():this.turnOffControls(),this}filters(){return this._filters}highlightSelected(t){r.select(t).classed(A.SELECTED_CLASS,!0),r.select(t).classed(A.DESELECTED_CLASS,!1)}fadeDeselected(t){r.select(t).classed(A.SELECTED_CLASS,!1),r.select(t).classed(A.DESELECTED_CLASS,!0)}resetHighlight(t){r.select(t).classed(A.SELECTED_CLASS,!1),r.select(t).classed(A.DESELECTED_CLASS,!1)}onClick(t){const e=this.keyAccessor()(t);T.trigger((()=>{this.filter(e),this.redrawGroup()}))}filterHandler(t){return arguments.length?(this._filterHandler=t,this):this._filterHandler}_doRender(){return this}_doRedraw(){return this}legendables(){return[]}legendHighlight(){}legendReset(){}legendToggle(){}isLegendableHidden(){return!1}keyAccessor(t){return arguments.length?(this._keyAccessor=t,this):this._keyAccessor}valueAccessor(t){return arguments.length?(this._valueAccessor=t,this):this._valueAccessor}label(t,e){return arguments.length?(this._label=t,(void 0===e||e)&&(this._renderLabel=!0),this):this._label}renderLabel(t){return arguments.length?(this._renderLabel=t,this):this._renderLabel}title(t){return arguments.length?(this._title=t,this):this._title}renderTitle(t){return arguments.length?(this._renderTitle=t,this):this._renderTitle}chartGroup(t){return arguments.length?(this._isChild||D(this,this._chartGroup),this._chartGroup=t,this._isChild||R(this,this._chartGroup),this):this._chartGroup}expireCache(){return this}legend(t){return arguments.length?(this._legend=t,this._legend.parent(this),this):this._legend}chartID(){return this.__dcFlag__}options(t){const e=["anchor","group","xAxisLabel","yAxisLabel","stack","title","point","getColor","overlayGeoJson"];for(const i in t)"function"==typeof this[i]?t[i]instanceof Array&&-1!==e.indexOf(i)?this[i].apply(this,t[i]):this[i].call(this,t[i]):C.debug("Not a valid option setter name: "+i);return this}on(t,e){return this._listeners.on(t,e),this}renderlet(t){return C.warnOnce('chart.renderlet has been deprecated. Please use chart.on("renderlet.<renderletKey>", renderletFunction)'),this.on("renderlet."+N.uniqueId(),t),this}}const K=t=>class extends t{constructor(){super(),this._colors=h.scaleOrdinal(S.defaultColors()),this._colorAccessor=t=>this.keyAccessor()(t),this._colorCalculator=void 0;{const t=this;t.getColor=function(e,i){return t._colorCalculator?t._colorCalculator.call(this,e,i):t._colors(t._colorAccessor.call(this,e,i))}}}calculateColorDomain(){const t=[a.min(this.data(),this.colorAccessor()),a.max(this.data(),this.colorAccessor())];return this._colors.domain(t),this}colors(t){return arguments.length?(this._colors=t instanceof Array?h.scaleQuantize().range(t):"function"==typeof t?t:N.constant(t),this):this._colors}ordinalColors(t){return this.colors(h.scaleOrdinal().range(t))}linearColors(t){return this.colors(h.scaleLinear().range(t).interpolate(l.interpolateHcl))}colorAccessor(t){return arguments.length?(this._colorAccessor=t,this):this._colorAccessor}colorDomain(t){return arguments.length?(this._colors.domain(t),this):this._colors.domain()}colorCalculator(t){return arguments.length?(this._colorCalculator=t,this):this._colorCalculator||this.getColor}},Z=t=>class extends(K(t)){constructor(){super(),this._maxBubbleRelativeSize=.3,this._minRadiusWithLabel=10,this._sortBubbleSize=!1,this._elasticRadius=!1,this._excludeElasticZero=!0,this.BUBBLE_NODE_CLASS="node",this.BUBBLE_CLASS="bubble",this.MIN_RADIUS=10,this.renderLabel(!0),this.data((t=>{const e=t.all();if(this._keyboardAccessible&&e.sort(((t,e)=>a.ascending(this.keyAccessor()(t),this.keyAccessor()(e)))),this._sortBubbleSize){const t=this.radiusValueAccessor();e.sort(((e,i)=>a.descending(t(e),t(i))))}return e})),this._r=h.scaleLinear().domain([0,100])}_rValueAccessor(t){return t.r}r(t){return arguments.length?(this._r=t,this):this._r}elasticRadius(t){return arguments.length?(this._elasticRadius=t,this):this._elasticRadius}calculateRadiusDomain(){this._elasticRadius&&this.r().domain([this.rMin(),this.rMax()])}radiusValueAccessor(t){return arguments.length?(this._rValueAccessor=t,this):this._rValueAccessor}rMin(){let t=this.data().map(this.radiusValueAccessor());return this._excludeElasticZero&&(t=t.filter((t=>t>0))),a.min(t)}rMax(){return a.max(this.data(),(t=>this.radiusValueAccessor()(t)))}bubbleR(t){const e=this.radiusValueAccessor()(t);let i=this.r()(e);return(isNaN(i)||e<=0)&&(i=0),i}_labelFunction(t){return this.label()(t)}_shouldLabel(t){return this.bubbleR(t)>this._minRadiusWithLabel}_labelOpacity(t){return this._shouldLabel(t)?1:0}_labelPointerEvent(t){return this._shouldLabel(t)?"all":"none"}_doRenderLabel(t){if(this.renderLabel()){let e=t.select("text");e.empty()&&(e=t.append("text").attr("text-anchor","middle").attr("dy",".3em").on("click",w.eventHandler((t=>this.onClick(t))))),e.attr("opacity",0).attr("pointer-events",(t=>this._labelPointerEvent(t))).text((t=>this._labelFunction(t))),F(e,this.transitionDuration(),this.transitionDelay()).attr("opacity",(t=>this._labelOpacity(t)))}}doUpdateLabels(t){if(this.renderLabel()){const e=t.select("text").attr("pointer-events",(t=>this._labelPointerEvent(t))).text((t=>this._labelFunction(t)));F(e,this.transitionDuration(),this.transitionDelay()).attr("opacity",(t=>this._labelOpacity(t)))}}_titleFunction(t){return this.title()(t)}_doRenderTitles(t){if(this.renderTitle()){t.select("title").empty()&&t.append("title").text((t=>this._titleFunction(t)))}}doUpdateTitles(t){this.renderTitle()&&t.select("title").text((t=>this._titleFunction(t)))}sortBubbleSize(t){return arguments.length?(this._sortBubbleSize=t,this):this._sortBubbleSize}minRadius(t){return arguments.length?(this.MIN_RADIUS=t,this):this.MIN_RADIUS}minRadiusWithLabel(t){return arguments.length?(this._minRadiusWithLabel=t,this):this._minRadiusWithLabel}maxBubbleRelativeSize(t){return arguments.length?(this._maxBubbleRelativeSize=t,this):this._maxBubbleRelativeSize}excludeElasticZero(t){return arguments.length?(this._excludeElasticZero=t,this):this._excludeElasticZero}fadeDeselectedArea(t){if(this.hasFilter()){const t=this;this.selectAll("g."+t.BUBBLE_NODE_CLASS).each((function(e){t.isSelectedNode(e)?t.highlightSelected(this):t.fadeDeselected(this)}))}else{const t=this;this.selectAll("g."+t.BUBBLE_NODE_CLASS).each((function(){t.resetHighlight(this)}))}}isSelectedNode(t){return this.hasFilter(t.key)}onClick(t){const e=t.key;T.trigger((()=>{this.filter(e),this.redrawGroup()}))}},J=t=>class extends t{constructor(){super(),this._cap=1/0,this._takeFront=!0,this._othersLabel="Others",this._othersGrouper=(t,e)=>{const i=a.sum(e,this.valueAccessor()),s=e.map(this.keyAccessor());return i>0?t.concat([{others:s,key:this.othersLabel(),value:i}]):t},this.ordering((t=>-t.value)),this.data((t=>{if(this._cap===1/0)return this._computeOrderedGroups(t.all());{let e,i=t.all();if(i=this._computeOrderedGroups(i),this._cap)if(this._takeFront)e=i.slice(this._cap),i=i.slice(0,this._cap);else{const t=Math.max(0,i.length-this._cap);e=i.slice(0,t),i=i.slice(t)}return this._othersGrouper?this._othersGrouper(i,e):i}}))}cappedKeyAccessor(t,e){return t.others?t.key:this.keyAccessor()(t,e)}cappedValueAccessor(t,e){return t.others?t.value:this.valueAccessor()(t,e)}cap(t){return arguments.length?(this._cap=t,this):this._cap}takeFront(t){return arguments.length?(this._takeFront=t,this):this._takeFront}othersLabel(t){return arguments.length?(this._othersLabel=t,this):this._othersLabel}othersGrouper(t){return arguments.length?(this._othersGrouper=t,this):this._othersGrouper}onClick(t){t.others&&this.filter([t.others]),super.onClick(t)}};class Q extends j{constructor(){super(),this._margin={top:10,right:50,bottom:30,left:30}}margins(t){return arguments.length?(this._margin=t,this):this._margin}effectiveWidth(){return this.width()-this.margins().left-this.margins().right}effectiveHeight(){return this.height()-this.margins().top-this.margins().bottom}}const tt="x-axis-label",et="custom-brush-handle";class it extends(K(Q)){constructor(){super(),this.colors(h.scaleOrdinal(o.schemeCategory10)),this._mandatoryAttributes().push("x"),this._parent=void 0,this._g=void 0,this._chartBodyG=void 0,this._x=void 0,this._origX=void 0,this._xOriginalDomain=void 0,this._xAxis=null,this._xUnits=V.integers,this._xAxisPadding=0,this._xAxisPaddingUnit=i.timeDay,this._xElasticity=!1,this._xAxisLabel=void 0,this._xAxisLabelPadding=0,this._lastXDomain=void 0,this._y=void 0,this._yAxis=null,this._yAxisPadding=0,this._yElasticity=!1,this._yAxisLabel=void 0,this._yAxisLabelPadding=0,this._brush=_.brushX(),this._gBrush=void 0,this._brushOn=!0,this._parentBrushOn=!1,this._round=void 0,this._ignoreBrushEvents=!1,this._renderHorizontalGridLine=!1,this._renderVerticalGridLine=!1,this._resizing=!1,this._unitCount=void 0,this._zoomScale=[1,1/0],this._zoomOutRestrict=!0,this._zoom=d.zoom().on("zoom",w.eventHandler(((t,e)=>this._onZoom(e)))),this._nullZoom=d.zoom().on("zoom",null),this._hasBeenMouseZoomable=!1,this._ignoreZoomEvents=!1,this._rangeChart=void 0,this._focusChart=void 0,this._mouseZoomable=!1,this._clipPadding=0,this._fOuterRangeBandPadding=.5,this._fRangeBandPadding=0,this._useRightYAxis=!1,this._useTopXAxis=!1}rescale(){return this._unitCount=void 0,this._resizing=!0,this}resizing(t){return arguments.length?(this._resizing=t,this):this._resizing}rangeChart(t){return arguments.length?(this._rangeChart=t,this._rangeChart.focusChart(this),this):this._rangeChart}zoomScale(t){return arguments.length?(this._zoomScale=t,this):this._zoomScale}zoomOutRestrict(t){return arguments.length?(this._zoomOutRestrict=t,this):this._zoomOutRestrict}_generateG(t){this._parent=void 0===t?this.svg():t;const e=window.location.href.split("#")[0];return this._g=this._parent.append("g"),this._chartBodyG=this._g.append("g").attr("class","chart-body").attr("transform",`translate(${this.margins().left}, ${this.margins().top})`).attr("clip-path",`url(${e}#${this._getClipPathId()})`),this._g}g(t){return arguments.length?(this._g=t,this):this._g}mouseZoomable(t){return arguments.length?(this._mouseZoomable=t,this):this._mouseZoomable}chartBodyG(t){return arguments.length?(this._chartBodyG=t,this):this._chartBodyG}x(t){return arguments.length?(this._x=t,this._xOriginalDomain=this._x.domain(),this.rescale(),this):this._x}xOriginalDomain(){return this._xOriginalDomain}xUnits(t){return arguments.length?(this._xUnits=t,this):this._xUnits}xAxis(t){return arguments.length?(this._xAxis=t,this):(this._xAxis||(this._xAxis=this._createXAxis()),this._xAxis)}elasticX(t){return arguments.length?(this._xElasticity=t,this):this._xElasticity}xAxisPadding(t){return arguments.length?(this._xAxisPadding=t,this):this._xAxisPadding}xAxisPaddingUnit(t){return arguments.length?(this._xAxisPaddingUnit=t,this):this._xAxisPaddingUnit}xUnitCount(){return void 0===this._unitCount&&(this.isOrdinal()?this._unitCount=this.x().domain().length:(this._unitCount=this.xUnits()(this.x().domain()[0],this.x().domain()[1]),this._unitCount instanceof Array&&(this._unitCount=this._unitCount.length))),this._unitCount}useRightYAxis(t){return arguments.length?(this._useRightYAxis!==t&&this._yAxis&&C.warn("Value of useRightYAxis has been altered, after yAxis was created. You might get unexpected yAxis behavior. Make calls to useRightYAxis sooner in your chart creation process."),this._useRightYAxis=t,this):this._useRightYAxis}useTopXAxis(t){return arguments.length?(this._useTopXAxis!==t&&this._xAxis&&C.warn("Value of useTopXAxis has been altered, after xAxis was created. You might get unexpected yAxis behavior. Make calls to useTopXAxis sooner in your chart creation process."),this._useTopXAxis=t,this):this._useTopXAxis}isOrdinal(){return this.xUnits()===V.ordinal}_useOuterPadding(){return!0}_ordinalXDomain(){return this._computeOrderedGroups(this.data()).map(this.keyAccessor())}_createXAxis(){return this._useTopXAxis?c.axisTop():c.axisBottom()}_prepareXAxis(t,e){this.isOrdinal()?(this._x.bandwidth||(C.warn("For compatibility with d3v4+, dc.js d3.0 ordinal bar/line/bubble charts need d3.scaleBand() for the x scale, instead of d3.scaleOrdinal(). Replacing .x() with a d3.scaleBand with the same domain - make the same change in your code to avoid this warning!"),this._x=h.scaleBand().domain(this._x.domain())),(this.elasticX()||0===this._x.domain().length)&&this._x.domain(this._ordinalXDomain())):this.elasticX()&&this._x.domain([this.xAxisMin(),this.xAxisMax()]);const i=this._x.domain();!e&&N.arraysEqual(this._lastXDomain,i)||this.rescale(),this._lastXDomain=i,this.isOrdinal()?this._x.range([0,this.xAxisLength()]).paddingInner(this._fRangeBandPadding).paddingOuter(this._useOuterPadding()?this._fOuterRangeBandPadding:0):this._x.range([0,this.xAxisLength()]),this._xAxis||(this._xAxis=this._createXAxis()),this._xAxis=this._xAxis.scale(this.x()),this._renderVerticalGridLines(t)}renderXAxis(t){let e=t.select("g.x");e.empty()&&(e=t.append("g").attr("class","axis x").attr("transform",`translate(${this.margins().left},${this._xAxisY()})`));let i=t.select("text.x-axis-label");const s=this._useTopXAxis?this._xAxisLabelPadding:this.height()-this._xAxisLabelPadding;i.empty()&&this.xAxisLabel()&&(i=t.append("text").attr("class",tt).attr("transform",`translate(${this.margins().left+this.xAxisLength()/2},${s})`).attr("text-anchor","middle")),this.xAxisLabel()&&i.text()!==this.xAxisLabel()&&i.text(this.xAxisLabel()),F(e,this.transitionDuration(),this.transitionDelay()).attr("transform",`translate(${this.margins().left},${this._xAxisY()})`).call(this._xAxis),F(i,this.transitionDuration(),this.transitionDelay()).attr("transform",`translate(${this.margins().left+this.xAxisLength()/2},${s})`)}_renderVerticalGridLines(t){let e=t.select("g.vertical");if(this._renderVerticalGridLine){e.empty()&&(e=t.insert("g",":first-child").attr("class","grid-line vertical").attr("transform",`translate(${this.margins().left},${this.margins().top})`));const i=this._xAxis.tickValues()?this._xAxis.tickValues():"function"==typeof this._x.ticks?this._x.ticks.apply(this._x,this._xAxis.tickArguments()):this._x.domain(),s=e.selectAll("line").data(i),r=s.enter().append("line").attr("x1",(t=>this._x(t))).attr("y1",this._xAxisY()-this.margins().top).attr("x2",(t=>this._x(t))).attr("y2",0).attr("opacity",0);F(r,this.transitionDuration(),this.transitionDelay()).attr("opacity",.5),F(s,this.transitionDuration(),this.transitionDelay()).attr("x1",(t=>this._x(t))).attr("y1",this._xAxisY()-this.margins().top).attr("x2",(t=>this._x(t))).attr("y2",0),s.exit().remove()}else e.selectAll("line").remove()}_xAxisY(){return this._useTopXAxis?this.margins().top:this.height()-this.margins().bottom}xAxisLength(){return this.effectiveWidth()}xAxisLabel(t,e){return arguments.length?(this._xAxisLabel=t,this.margins().bottom-=this._xAxisLabelPadding,this._xAxisLabelPadding=void 0===e?12:e,this.margins().bottom+=this._xAxisLabelPadding,this):this._xAxisLabel}_createYAxis(){return this._useRightYAxis?c.axisRight():c.axisLeft()}_prepareYAxis(t){if(void 0===this._y||this.elasticY()){void 0===this._y&&(this._y=h.scaleLinear());const t=this.yAxisMin()||0,e=this.yAxisMax()||0;this._y.domain([t,e]).rangeRound([this.yAxisHeight(),0])}this._y.range([this.yAxisHeight(),0]),this._yAxis||(this._yAxis=this._createYAxis()),this._yAxis.scale(this._y),this._renderHorizontalGridLinesForAxis(t,this._y,this._yAxis)}renderYAxisLabel(t,e,i,s){s=s||this._yAxisLabelPadding;let r=this.g().select(`text.y-axis-label.${t}-label`);const n=this.margins().top+this.yAxisHeight()/2;r.empty()&&e&&(r=this.g().append("text").attr("transform",`translate(${s},${n}),rotate(${i})`).attr("class",`y-axis-label ${t}-label`).attr("text-anchor","middle").text(e)),e&&r.text()!==e&&r.text(e),F(r,this.transitionDuration(),this.transitionDelay()).attr("transform",`translate(${s},${n}),rotate(${i})`)}renderYAxisAt(t,e,i){let s=this.g().select("g."+t);s.empty()&&(s=this.g().append("g").attr("class","axis "+t).attr("transform",`translate(${i},${this.margins().top})`)),F(s,this.transitionDuration(),this.transitionDelay()).attr("transform",`translate(${i},${this.margins().top})`).call(e)}renderYAxis(){const t=this._useRightYAxis?this.width()-this.margins().right:this._yAxisX();this.renderYAxisAt("y",this._yAxis,t);const e=this._useRightYAxis?this.width()-this._yAxisLabelPadding:this._yAxisLabelPadding,i=this._useRightYAxis?90:-90;this.renderYAxisLabel("y",this.yAxisLabel(),i,e)}_renderHorizontalGridLinesForAxis(t,e,i){let s=t.select("g.horizontal");if(this._renderHorizontalGridLine){const r=i.tickValues()?i.tickValues():e.ticks?e.ticks.apply(e,i.tickArguments()):e.domain();s.empty()&&(s=t.insert("g",":first-child").attr("class","grid-line horizontal").attr("transform",`translate(${this.margins().left},${this.margins().top})`));const n=s.selectAll("line").data(r),a=n.enter().append("line").attr("x1",1).attr("y1",(t=>e(t))).attr("x2",this.xAxisLength()).attr("y2",(t=>e(t))).attr("opacity",0);F(a,this.transitionDuration(),this.transitionDelay()).attr("opacity",.5),F(n,this.transitionDuration(),this.transitionDelay()).attr("x1",1).attr("y1",(t=>e(t))).attr("x2",this.xAxisLength()).attr("y2",(t=>e(t))),n.exit().remove()}else s.selectAll("line").remove()}_yAxisX(){return this.useRightYAxis()?this.width()-this.margins().right:this.margins().left}yAxisLabel(t,e){return arguments.length?(this._yAxisLabel=t,this.margins().left-=this._yAxisLabelPadding,this._yAxisLabelPadding=void 0===e?12:e,this.margins().left+=this._yAxisLabelPadding,this):this._yAxisLabel}y(t){return arguments.length?(this._y=t,this.rescale(),this):this._y}yAxis(t){return arguments.length?(this._yAxis=t,this):(this._yAxis||(this._yAxis=this._createYAxis()),this._yAxis)}elasticY(t){return arguments.length?(this._yElasticity=t,this):this._yElasticity}renderHorizontalGridLines(t){return arguments.length?(this._renderHorizontalGridLine=t,this):this._renderHorizontalGridLine}renderVerticalGridLines(t){return arguments.length?(this._renderVerticalGridLine=t,this):this._renderVerticalGridLine}xAxisMin(){const t=a.min(this.data(),(t=>this.keyAccessor()(t)));return N.subtract(t,this._xAxisPadding,this._xAxisPaddingUnit)}xAxisMax(){const t=a.max(this.data(),(t=>this.keyAccessor()(t)));return N.add(t,this._xAxisPadding,this._xAxisPaddingUnit)}yAxisMin(){const t=a.min(this.data(),(t=>this.valueAccessor()(t)));return N.subtract(t,this._yAxisPadding)}yAxisMax(){const t=a.max(this.data(),(t=>this.valueAccessor()(t)));return N.add(t,this._yAxisPadding)}yAxisPadding(t){return arguments.length?(this._yAxisPadding=t,this):this._yAxisPadding}yAxisHeight(){return this.effectiveHeight()}round(t){return arguments.length?(this._round=t,this):this._round}_rangeBandPadding(t){return arguments.length?(this._fRangeBandPadding=t,this):this._fRangeBandPadding}_outerRangeBandPadding(t){return arguments.length?(this._fOuterRangeBandPadding=t,this):this._fOuterRangeBandPadding}filter(t){return arguments.length?(super.filter(t),this.redrawBrush(t,!1),this):super.filter()}brush(t){return arguments.length?(this._brush=t,this):this._brush}renderBrush(t,e){this._brushOn&&(this._brush.on("start brush end",w.eventHandler(((t,e)=>this._brushing(e)))),this._gBrush=t.append("g").attr("class","brush").attr("transform",`translate(${this.margins().left},${this.margins().top})`),this.setBrushExtents(),this.createBrushHandlePaths(this._gBrush,e),this.redrawBrush(this.filter(),e))}createBrushHandlePaths(t){let e=t.selectAll("path.custom-brush-handle").data([{type:"w"},{type:"e"}]);e=e.enter().append("path").attr("class",et).merge(e),e.attr("d",(t=>this.resizeHandlePath(t)))}extendBrush(t){return t&&this.round()&&(t[0]=this.round()(t[0]),t[1]=this.round()(t[1])),t}brushIsEmpty(t){return!t||t[1]<=t[0]}_brushing(t){if(this._ignoreBrushEvents)return;let e=t.selection;e&&(e=e.map(this.x().invert)),e=this.extendBrush(e),this.redrawBrush(e,!1);const i=this.brushIsEmpty(e)?null:E.RangedFilter(e[0],e[1]);T.trigger((()=>{this.applyBrushSelection(i)}),A.EVENT_DELAY)}applyBrushSelection(t){this.replaceFilter(t),this.redrawGroup()}_withoutBrushEvents(t){const e=this._ignoreBrushEvents;this._ignoreBrushEvents=!0;try{t()}finally{this._ignoreBrushEvents=e}}setBrushExtents(t){this._withoutBrushEvents((()=>{this._brush.extent([[0,0],[this.effectiveWidth(),this.effectiveHeight()]])})),this._gBrush.call(this._brush)}redrawBrush(t,e){if(this._brushOn&&this._gBrush)if(this._resizing&&this.setBrushExtents(e),t){const i=[this._x(t[0]),this._x(t[1])],s=P(e,this.transitionDuration(),this.transitionDelay())(this._gBrush);this._withoutBrushEvents((()=>{s.call(this._brush.move,i)})),s.selectAll("path.custom-brush-handle").attr("display",null).attr("transform",((e,i)=>`translate(${this._x(t[i])}, 0)`)).attr("d",(t=>this.resizeHandlePath(t)))}else this._withoutBrushEvents((()=>{this._gBrush.call(this._brush.move,null)})),this._gBrush.selectAll("path.custom-brush-handle").attr("display","none");this.fadeDeselectedArea(t)}fadeDeselectedArea(t){}resizeHandlePath(t){const e=+("e"===(t=t.type)),i=e?1:-1,s=this.effectiveHeight()/3;return`M${.5*i},${s}A6,6 0 0 ${e} ${6.5*i},${s+6}V${2*s-6}A6,6 0 0 ${e} ${.5*i},${2*s}ZM${2.5*i},${s+8}V${2*s-8}M${4.5*i},${s+8}V${2*s-8}`}_getClipPathId(){return this.anchorName().replace(/[ .#=\[\]"]/g,"-")+"-clip"}clipPadding(t){return arguments.length?(this._clipPadding=t,this):this._clipPadding}_generateClipPath(){const t=N.appendOrSelect(this._parent,"defs"),e=this._getClipPathId(),i=N.appendOrSelect(t,"#"+e,"clipPath").attr("id",e),s=2*this._clipPadding;N.appendOrSelect(i,"rect").attr("width",this.xAxisLength()+s).attr("height",this.yAxisHeight()+s).attr("transform",`translate(-${this._clipPadding}, -${this._clipPadding})`)}_preprocessData(){}_doRender(){return this.resetSvg(),this._preprocessData(),this._generateG(),this._generateClipPath(),this._drawChart(!0),this._configureMouseZoom(),this}_doRedraw(){return this._preprocessData(),this._drawChart(!1),this._generateClipPath(),this}_drawChart(t){this.isOrdinal()&&(this._brushOn=!1),this._prepareXAxis(this.g(),t),this._prepareYAxis(this.g()),this.plotData(),(this.elasticX()||this._resizing||t)&&this.renderXAxis(this.g()),(this.elasticY()||this._resizing||t)&&this.renderYAxis(this.g()),t?this.renderBrush(this.g(),!1):this.redrawBrush(this.filter(),this._resizing),this.fadeDeselectedArea(this.filter()),this.resizing(!1)}_configureMouseZoom(){this._origX=this._x.copy(),this._mouseZoomable?this._enableMouseZoom():this._hasBeenMouseZoomable&&this._disableMouseZoom()}_enableMouseZoom(){this._hasBeenMouseZoomable=!0;const t=[[0,0],[this.effectiveWidth(),this.effectiveHeight()]];if(this._zoom.scaleExtent(this._zoomScale).extent(t).duration(this.transitionDuration()),this._zoomOutRestrict){const e=Math.max(this._zoomScale[0],1);this._zoom.translateExtent(t).scaleExtent([e,this._zoomScale[1]])}this.root().call(this._zoom),this._updateD3zoomTransform()}_disableMouseZoom(){this.root().call(this._nullZoom)}_zoomHandler(t,e){let i;this._hasRangeSelected(t)?(this.x().domain(t),i=E.RangedFilter(t[0],t[1])):(this.x().domain(this._xOriginalDomain),i=null),this.replaceFilter(i),this.rescale(),this.redraw(),e||(this._rangeChart&&!N.arraysEqual(this.filter(),this._rangeChart.filter())&&T.trigger((()=>{this._rangeChart.replaceFilter(i),this._rangeChart.redraw()})),this._invokeZoomedListener(),T.trigger((()=>{this.redrawGroup()}),A.EVENT_DELAY))}_domainToZoomTransform(t,e,i){const s=(e[1]-e[0])/(t[1]-t[0]),r=-1*i(t[0]);return d.zoomIdentity.scale(s).translate(r,0)}_updateD3zoomTransform(){this._zoom&&this._withoutZoomEvents((()=>{this._zoom.transform(this.root(),this._domainToZoomTransform(this.x().domain(),this._xOriginalDomain,this._origX))}))}_withoutZoomEvents(t){const e=this._ignoreZoomEvents;this._ignoreZoomEvents=!0;try{t()}finally{this._ignoreZoomEvents=e}}_onZoom(t){if(this._ignoreZoomEvents)return;const e=t.transform.rescaleX(this._origX).domain();this.focus(e,!1)}_checkExtents(t,e){return t&&2===t.length&&e&&2===e.length?((t[0]>e[1]||t[1]<e[0])&&console.warn("Could not intersect extents, will reset"),[t[0]>e[0]?t[0]:e[0],t[1]<e[1]?t[1]:e[1]]):t}focus(t,e){this._zoomOutRestrict&&(t=this._checkExtents(t,this._xOriginalDomain),this._rangeChart&&(t=this._checkExtents(t,this._rangeChart.x().domain()))),this._zoomHandler(t,e),this._updateD3zoomTransform()}refocused(){return!N.arraysEqual(this.x().domain(),this._xOriginalDomain)}focusChart(t){return arguments.length?(this._focusChart=t,this.on("filtered.dcjs-range-chart",(t=>{t.filter()?N.arraysEqual(t.filter(),this._focusChart.filter())||T.trigger((()=>{this._focusChart.focus(t.filter(),!0)})):T.trigger((()=>{this._focusChart.x().domain(this._focusChart.xOriginalDomain(),!0)}))})),this):this._focusChart}brushOn(t){return arguments.length?(this._brushOn=t,this):this._brushOn}parentBrushOn(t){return arguments.length?(this._parentBrushOn=t,this):this._parentBrushOn}gBrush(){return this._gBrush}_hasRangeSelected(t){return t instanceof Array&&t.length>1}}const st=function(){let t=1,e=1,i=0;let s=null,n=Number,l=rt,o=nt,c=null,d=!1;let _=.3,g=.8,p=!1,y=!0,m=!1;function x(x){x.each((function(u,x){u=u.map(n).sort(a.ascending);const f=r.select(this),b=u.length;let A,v;if(0===b)return;const C=u.quartiles=o(u),k=l&&l.call(this,u,x),S=k&&k.map((t=>u[t])),w=k?a.range(0,k[0]).concat(a.range(k[1]+1,b)):a.range(b);y?(A=u[0],v=u[b-1]):(A=u[k[0]],v=u[k[1]]);const L=a.range(k[0],k[1]+1),R=h.scaleLinear().domain(s&&s.call(this,u,x)||[A,v]).range([e,0]),D=this.__chart__||h.scaleLinear().domain([0,1/0]).range(R.range());this.__chart__=R;const O=f.selectAll("line.center").data(S?[S]:[]);O.enter().insert("line","rect").attr("class","center").attr("x1",t/2).attr("y1",(t=>D(t[0]))).attr("x2",t/2).attr("y2",(t=>D(t[1]))).style("opacity",1e-6).transition().duration(i).delay(0).style("opacity",1).attr("y1",(t=>R(t[0]))).attr("y2",(t=>R(t[1]))),O.transition().duration(i).delay(0).style("opacity",1).attr("x1",t/2).attr("x2",t/2).attr("y1",(t=>R(t[0]))).attr("y2",(t=>R(t[1]))),O.exit().transition().duration(i).delay(0).style("opacity",1e-6).attr("y1",(t=>R(t[0]))).attr("y2",(t=>R(t[1]))).remove();const B=f.selectAll("rect.box").data([C]);B.enter().append("rect").attr("class","box").attr("x",0).attr("y",(t=>D(t[2]))).attr("width",t).attr("height",(t=>D(t[0])-D(t[2]))).style("fill-opacity",d?.1:1).transition().duration(i).delay(0).attr("y",(t=>R(t[2]))).attr("height",(t=>R(t[0])-R(t[2]))),B.transition().duration(i).delay(0).attr("width",t).attr("y",(t=>R(t[2]))).attr("height",(t=>R(t[0])-R(t[2])));const F=f.selectAll("line.median").data([C[1]]);F.enter().append("line").attr("class","median").attr("x1",0).attr("y1",D).attr("x2",t).attr("y2",D).transition().duration(i).delay(0).attr("y1",R).attr("y2",R),F.transition().duration(i).delay(0).attr("x1",0).attr("x2",t).attr("y1",R).attr("y2",R);const P=f.selectAll("line.whisker").data(S||[]);if(P.enter().insert("line","circle, text").attr("class","whisker").attr("x1",0).attr("y1",D).attr("x2",t).attr("y2",D).style("opacity",1e-6).transition().duration(i).delay(0).attr("y1",R).attr("y2",R).style("opacity",1),P.transition().duration(i).delay(0).attr("x1",0).attr("x2",t).attr("y1",R).attr("y2",R).style("opacity",1),P.exit().transition().duration(i).delay(0).attr("y1",R).attr("y2",R).style("opacity",1e-6).remove(),y){const e=m?"outlierBold":"outlier",s=m?3:5,r=m?function(){return Math.floor(Math.random()*(t*g)+1+(t-t*g)/2)}:function(){return t/2},n=f.selectAll("circle."+e).data(w,Number);n.enter().insert("circle","text").attr("class",e).attr("r",s).attr("cx",r).attr("cy",(t=>D(u[t]))).style("opacity",1e-6).transition().duration(i).delay(0).attr("cy",(t=>R(u[t]))).style("opacity",.6),p&&(n.selectAll("title").remove(),n.append("title").text((t=>u[t]))),n.transition().duration(i).delay(0).attr("cx",r).attr("cy",(t=>R(u[t]))).style("opacity",.6),n.exit().transition().duration(i).delay(0).attr("cy",0).style("opacity",1e-6).remove()}if(d){const e=f.selectAll("circle.data").data(L);e.enter().insert("circle","text").attr("class","data").attr("r",3).attr("cx",(()=>Math.floor(Math.random()*(t*g)+1+(t-t*g)/2))).attr("cy",(t=>D(u[t]))).style("opacity",1e-6).transition().duration(i).delay(0).attr("cy",(t=>R(u[t]))).style("opacity",_),p&&(e.selectAll("title").remove(),e.append("title").text((t=>u[t]))),e.transition().duration(i).delay(0).attr("cx",(()=>Math.floor(Math.random()*(t*g)+1+(t-t*g)/2))).attr("cy",(t=>R(u[t]))).style("opacity",_),e.exit().transition().duration(i).delay(0).attr("cy",0).style("opacity",1e-6).remove()}const H=c||R.tickFormat(8),T=f.selectAll("text.box").data(C);T.enter().append("text").attr("class","box").attr("dy",".3em").attr("dx",((t,e)=>1&e?6:-6)).attr("x",((e,i)=>1&i?t:0)).attr("y",D).attr("text-anchor",((t,e)=>1&e?"start":"end")).text(H).transition().duration(i).delay(0).attr("y",R),T.transition().duration(i).delay(0).text(H).attr("x",((e,i)=>1&i?t:0)).attr("y",R);const E=f.selectAll("text.whisker").data(S||[]);E.enter().append("text").attr("class","whisker").attr("dy",".3em").attr("dx",6).attr("x",t).attr("y",D).text(H).style("opacity",1e-6).transition().duration(i).delay(0).attr("y",R).style("opacity",1),E.transition().duration(i).delay(0).text(H).attr("x",t).attr("y",R).style("opacity",1),E.exit().transition().duration(i).delay(0).attr("y",R).style("opacity",1e-6).remove(),delete u.quartiles})),u.timerFlush()}return x.width=function(e){return arguments.length?(t=e,x):t},x.height=function(t){return arguments.length?(e=t,x):e},x.tickFormat=function(t){return arguments.length?(c=t,x):c},x.showOutliers=function(t){return arguments.length?(y=t,x):y},x.boldOutlier=function(t){return arguments.length?(m=t,x):m},x.renderDataPoints=function(t){return arguments.length?(d=t,x):d},x.renderTitle=function(t){return arguments.length?(p=t,x):p},x.dataOpacity=function(t){return arguments.length?(_=t,x):_},x.dataWidthPortion=function(t){return arguments.length?(g=t,x):g},x.duration=function(t){return arguments.length?(i=t,x):i},x.domain=function(t){return arguments.length?(s=null===t||"function"==typeof t?t:N.constant(t),x):s},x.value=function(t){return arguments.length?(n=t,x):n},x.whiskers=function(t){return arguments.length?(l=t,x):l},x.quartiles=function(t){return arguments.length?(o=t,x):o},x};function rt(t){return[0,t.length-1]}function nt(t){return[a.quantile(t,.25),a.quantile(t,.5),a.quantile(t,.75)]}class at extends it{constructor(){super(),this._stackLayout=g.stack(),this._stack=[],this._titles={},this._hidableStacks=!1,this._evadeDomainFilter=!1,this.data((()=>{const t=this._stack.filter(this._visibility);if(!t.length)return[];t.forEach(((t,e)=>this._prepareValues(t,e)));const e=t[0].values.map(((e,i)=>{const s={x:e.x};return t.forEach((t=>{s[t.name]=t.values[i].y})),s})),i=t.map((t=>t.name));return this.stackLayout().keys(i)(e).forEach(((e,i)=>{e.forEach(((e,s)=>{t[i].values[s].y0=e[0],t[i].values[s].y1=e[1]}))})),t})),this.colorAccessor((function(t){return this.layer||this.name||t.name||t.layer}))}_prepareValues(t,e){const i=t.accessor||this.valueAccessor();t.name=String(t.name||e);const s=t.group.all().map(((e,s)=>({x:this.keyAccessor()(e,s),y:t.hidden?null:i(e,s),data:e,layer:t.name,hidden:t.hidden})));t.domainValues=s.filter((t=>this._domainFilter()(t))),t.values=this.evadeDomainFilter()?s:t.domainValues}_domainFilter(){if(!this.x())return N.constant(!0);const t=this.x().domain();return this.isOrdinal()||this.elasticX()?()=>!0:e=>e.x>=t[0]&&e.x<=t[t.length-1]}stack(t,e,i){if(!arguments.length)return this._stack;arguments.length<=2&&(i=e);const s={group:t};return"string"==typeof e&&(s.name=e),"function"==typeof i&&(s.accessor=i),this._stack.push(s),this}group(t,e,i){return arguments.length?(this._stack=[],this._titles={},this.stack(t,e),i&&this.valueAccessor(i),super.group(t,e)):super.group()}hidableStacks(t){return arguments.length?(this._hidableStacks=t,this):this._hidableStacks}_findLayerByName(t){const e=this._stack.map(M("name")).indexOf(t);return this._stack[e]}hideStack(t){const e=this._findLayerByName(t);return e&&(e.hidden=!0),this}showStack(t){const e=this._findLayerByName(t);return e&&(e.hidden=!1),this}getValueAccessorByIndex(t){return this._stack[t].accessor||this.valueAccessor()}yAxisMin(){const t=a.min(this._flattenStack(),(t=>t.y<0?t.y+t.y0:t.y0));return N.subtract(t,this.yAxisPadding())}yAxisMax(){const t=a.max(this._flattenStack(),(t=>t.y>0?t.y+t.y0:t.y0));return N.add(t,this.yAxisPadding())}_flattenStack(){const t=this.data().map((t=>t.domainValues));return[].concat(...t)}xAxisMin(){const t=a.min(this._flattenStack(),M("x"));return N.subtract(t,this.xAxisPadding(),this.xAxisPaddingUnit())}xAxisMax(){const t=a.max(this._flattenStack(),M("x"));return N.add(t,this.xAxisPadding(),this.xAxisPaddingUnit())}title(t,e){return t?"function"==typeof t?super.title(t):t===this._groupName&&"function"==typeof e?super.title(e):"function"!=typeof e?this._titles[t]||super.title():(this._titles[t]=e,this):super.title()}stackLayout(t){return arguments.length?(this._stackLayout=t,this):this._stackLayout}evadeDomainFilter(t){return arguments.length?(this._evadeDomainFilter=t,this):this._evadeDomainFilter}_visibility(t){return!t.hidden}_ordinalXDomain(){const t=this._flattenStack().map(M("data"));return this._computeOrderedGroups(t).map(this.keyAccessor())}legendables(){return this._stack.map(((t,e)=>({chart:this,name:t.name,hidden:t.hidden||!1,color:this.getColor.call(t,t.values,e)})))}isLegendableHidden(t){const e=this._findLayerByName(t.name);return!!e&&e.hidden}legendToggle(t){this._hidableStacks&&(this.isLegendableHidden(t)?this.showStack(t.name):this.hideStack(t.name),this.renderGroup())}}class ht extends at{constructor(t,e){super(),this._gap=2,this._centerBar=!1,this._alwaysUseRounding=!1,this._barWidth=void 0,this.label((t=>N.printSingleValue(t.y0+t.y)),!1),this.anchor(t,e)}outerPadding(t){return arguments.length?this._outerRangeBandPadding(t):this._outerRangeBandPadding()}rescale(){return super.rescale(),this._barWidth=void 0,this}render(){return this.round()&&this._centerBar&&!this._alwaysUseRounding&&C.warn("By default, brush rounding is disabled if bars are centered. See dc.js bar chart API documentation for details."),super.render()}plotData(){let t=this.chartBodyG().selectAll("g.stack").data(this.data());this._calculateBarWidth(),t=t.enter().append("g").attr("class",((t,e)=>"stack _"+e)).merge(t);const e=t.size()-1;{const i=this;t.each((function(t,s){const n=r.select(this);i._renderBars(n,s,t),i.renderLabel()&&e===s&&i._renderLabels(n,s,t)}))}}_barHeight(t){return N.safeNumber(Math.abs(this.y()(t.y+t.y0)-this.y()(t.y0)))}_labelXPos(t){let e=this.x()(t.x);return this._centerBar||(e+=this._barWidth/2),this.isOrdinal()&&void 0!==this._gap&&(e+=this._gap/2),N.safeNumber(e)}_labelYPos(t){let e=this.y()(t.y+t.y0);return t.y<0&&(e-=this._barHeight(t)),N.safeNumber(e-3)}_renderLabels(t,e,i){const s=t.selectAll("text.barLabel").data(i.values,M("x")),r=s.enter().append("text").attr("class","barLabel").attr("text-anchor","middle").attr("x",(t=>this._labelXPos(t))).attr("y",(t=>this._labelYPos(t))).merge(s);this.isOrdinal()&&(r.on("click",w.eventHandler((t=>this.onClick(t)))),r.attr("cursor","pointer")),F(r,this.transitionDuration(),this.transitionDelay()).attr("x",(t=>this._labelXPos(t))).attr("y",(t=>this._labelYPos(t))).text((t=>this.label()(t))),F(s.exit(),this.transitionDuration(),this.transitionDelay()).attr("height",0).remove()}_barXPos(t){let e=this.x()(t.x);return this._centerBar&&(e-=this._barWidth/2),this.isOrdinal()&&void 0!==this._gap&&(e+=this._gap/2),N.safeNumber(e)}_renderBars(t,e,i){const s=t.selectAll("rect.bar").data(i.values,M("x")),r=s.enter().append("rect").attr("class","bar").classed("dc-tabbable",this._keyboardAccessible).attr("fill",M("data",this.getColor)).attr("x",(t=>this._barXPos(t))).attr("y",this.yAxisHeight()).attr("height",0),n=r.merge(s);this.renderTitle()&&r.append("title").text(M("data",this.title(i.name))),this.isOrdinal()&&n.on("click",w.eventHandler((t=>this.onClick(t)))),this._keyboardAccessible&&this._makeKeyboardAccessible(this.onClick),F(n,this.transitionDuration(),this.transitionDelay()).attr("x",(t=>this._barXPos(t))).attr("y",(t=>{let e=this.y()(t.y+t.y0);return t.y<0&&(e-=this._barHeight(t)),N.safeNumber(e)})).attr("width",this._barWidth).attr("height",(t=>this._barHeight(t))).attr("fill",M("data",this.getColor)).select("title").text(M("data",this.title(i.name))),F(s.exit(),this.transitionDuration(),this.transitionDelay()).attr("x",(t=>this.x()(t.x))).attr("width",.9*this._barWidth).remove()}_calculateBarWidth(){if(void 0===this._barWidth){const t=this.xUnitCount();this.isOrdinal()&&void 0===this._gap?this._barWidth=Math.floor(this.x().bandwidth()):this._gap?this._barWidth=Math.floor((this.xAxisLength()-(t-1)*this._gap)/t):this._barWidth=Math.floor(this.xAxisLength()/(1+this.barPadding())/t),(this._barWidth===1/0||isNaN(this._barWidth)||this._barWidth<1)&&(this._barWidth=1)}}fadeDeselectedArea(t){const e=this.chartBodyG().selectAll("rect.bar");if(this.isOrdinal())this.hasFilter()?(e.classed(A.SELECTED_CLASS,(t=>this.hasFilter(t.x))),e.classed(A.DESELECTED_CLASS,(t=>!this.hasFilter(t.x)))):(e.classed(A.SELECTED_CLASS,!1),e.classed(A.DESELECTED_CLASS,!1));else if(this.brushOn()||this.parentBrushOn())if(this.brushIsEmpty(t))e.classed(A.DESELECTED_CLASS,!1);else{const i=t[0],s=t[1];e.classed(A.DESELECTED_CLASS,(t=>t.x<i||t.x>=s))}}centerBar(t){return arguments.length?(this._centerBar=t,this):this._centerBar}onClick(t){super.onClick(t.data)}barPadding(t){return arguments.length?(this._rangeBandPadding(t),this._gap=void 0,this):this._rangeBandPadding()}_useOuterPadding(){return void 0===this._gap}gap(t){return arguments.length?(this._gap=t,this):this._gap}extendBrush(t){return t&&this.round()&&(!this._centerBar||this._alwaysUseRounding)&&(t[0]=this.round()(t[0]),t[1]=this.round()(t[1])),t}alwaysUseRounding(t){return arguments.length?(this._alwaysUseRounding=t,this):this._alwaysUseRounding}legendHighlight(t){const e=(t,e)=>function(){const i=r.select(this).attr("fill")===t;return e?!i:i};this.isLegendableHidden(t)||this.g().selectAll("rect.bar").classed("highlight",e(t.color)).classed("fadeout",e(t.color,!0))}legendReset(){this.g().selectAll("rect.bar").classed("highlight",!1).classed("fadeout",!1)}xAxisMax(){let t=super.xAxisMax();if("resolution"in this.xUnits()){t+=this.xUnits().resolution}return t}}function lt(t){return e=>{const i=e.quartiles[0],s=e.quartiles[2],r=(s-i)*t;let n=-1,a=e.length;do{++n}while(e[n]<i-r);do{--a}while(e[a]>s+r);return[n,a]}}class ot extends it{constructor(t,e){super(),this._whiskerIqrFactor=1.5,this._whiskersIqr=lt,this._whiskers=this._whiskersIqr(this._whiskerIqrFactor),this._box=st(),this._tickFormat=null,this._renderDataPoints=!1,this._dataOpacity=.3,this._dataWidthPortion=.8,this._showOutliers=!0,this._boldOutlier=!1,this._yRangePadding=8,this._boxWidth=(t,e)=>this.isOrdinal()?this.x().bandwidth():t/(1+this.boxPadding())/e,this.x(h.scaleBand()),this.xUnits(V.ordinal),this.data((t=>t.all().map((t=>(t.map=e=>e.call(t,t),t))).filter((t=>0!==this.valueAccessor()(t).length)))),this.boxPadding(.8),this.outerPadding(.5),this.anchor(t,e)}boxPadding(t){return arguments.length?this._rangeBandPadding(t):this._rangeBandPadding()}outerPadding(t){return arguments.length?this._outerRangeBandPadding(t):this._outerRangeBandPadding()}boxWidth(t){return arguments.length?(this._boxWidth="function"==typeof t?t:N.constant(t),this):this._boxWidth}_boxTransform(t,e){return`translate(${this.x()(this.keyAccessor()(t,e))}, 0)`}_preprocessData(){this.elasticX()&&this.x().domain([])}plotData(){this._calculatedBoxWidth=this._boxWidth(this.effectiveWidth(),this.xUnitCount()),this._box.whiskers(this._whiskers).width(this._calculatedBoxWidth).height(this.effectiveHeight()).value(this.valueAccessor()).domain(this.y().domain()).duration(this.transitionDuration()).tickFormat(this._tickFormat).renderDataPoints(this._renderDataPoints).dataOpacity(this._dataOpacity).dataWidthPortion(this._dataWidthPortion).renderTitle(this.renderTitle()).showOutliers(this._showOutliers).boldOutlier(this._boldOutlier);const t=this.chartBodyG().selectAll("g.box").data(this.data(),this.keyAccessor()),e=this._renderBoxes(t);this._updateBoxes(e),this._removeBoxes(t),this.fadeDeselectedArea(this.filter())}_renderBoxes(t){const e=t.enter().append("g");return e.attr("class","box").classed("dc-tabbable",this._keyboardAccessible).attr("transform",((t,e)=>this._boxTransform(t,e))).call(this._box).on("click",w.eventHandler((t=>{this.filter(this.keyAccessor()(t)),this.redrawGroup()}))).selectAll("circle").classed("dc-tabbable",this._keyboardAccessible),this._keyboardAccessible&&this._makeKeyboardAccessible(this.onClick),e.merge(t)}_updateBoxes(t){const e=this;F(t,this.transitionDuration(),this.transitionDelay()).attr("transform",((t,e)=>this._boxTransform(t,e))).call(this._box).each((function(t){const i=e.getColor(t,0);r.select(this).select("rect.box").attr("fill",i),r.select(this).selectAll("circle.data").attr("fill",i)}))}_removeBoxes(t){t.exit().remove().call(this._box)}_minDataValue(){return a.min(this.data(),(t=>a.min(this.valueAccessor()(t))))}_maxDataValue(){return a.max(this.data(),(t=>a.max(this.valueAccessor()(t))))}_yAxisRangeRatio(){return(this._maxDataValue()-this._minDataValue())/this.effectiveHeight()}onClick(t){this.filter(this.keyAccessor()(t)),this.redrawGroup()}fadeDeselectedArea(t){const e=this;if(this.hasFilter())if(this.isOrdinal())this.g().selectAll("g.box").each((function(t){e.isSelectedNode(t)?e.highlightSelected(this):e.fadeDeselected(this)}));else{if(!this.brushOn()&&!this.parentBrushOn())return;const i=t[0],s=t[1];this.g().selectAll("g.box").each((function(t){const r=e.keyAccessor()(t);r<i||r>=s?e.fadeDeselected(this):e.highlightSelected(this)}))}else this.g().selectAll("g.box").each((function(){e.resetHighlight(this)}))}isSelectedNode(t){return this.hasFilter(this.keyAccessor()(t))}yAxisMin(){const t=this._yRangePadding*this._yAxisRangeRatio();return N.subtract(this._minDataValue()-t,this.yAxisPadding())}yAxisMax(){const t=this._yRangePadding*this._yAxisRangeRatio();return N.add(this._maxDataValue()+t,this.yAxisPadding())}tickFormat(t){return arguments.length?(this._tickFormat=t,this):this._tickFormat}yRangePadding(t){return arguments.length?(this._yRangePadding=t,this):this._yRangePadding}renderDataPoints(t){return arguments.length?(this._renderDataPoints=t,this):this._renderDataPoints}dataOpacity(t){return arguments.length?(this._dataOpacity=t,this):this._dataOpacity}dataWidthPortion(t){return arguments.length?(this._dataWidthPortion=t,this):this._dataWidthPortion}showOutliers(t){return arguments.length?(this._showOutliers=t,this):this._showOutliers}boldOutlier(t){return arguments.length?(this._boldOutlier=t,this):this._boldOutlier}}class ct extends(Z(it)){constructor(t,e){super(),this.transitionDuration(750),this.transitionDelay(0),this.anchor(t,e)}_bubbleLocator(t){return`translate(${this._bubbleX(t)},${this._bubbleY(t)})`}plotData(){this.calculateRadiusDomain(),this.r().range([this.MIN_RADIUS,this.xAxisLength()*this.maxBubbleRelativeSize()]);const t=this.data();let e=this.chartBodyG().selectAll("g."+this.BUBBLE_NODE_CLASS).data(t,(t=>t.key));(this.sortBubbleSize()||this.keyboardAccessible())&&e.order(),this._removeNodes(e),e=this._renderNodes(e),this._updateNodes(e),this.fadeDeselectedArea(this.filter())}_renderNodes(t){const e=t.enter().append("g");return e.attr("class",this.BUBBLE_NODE_CLASS).attr("transform",(t=>this._bubbleLocator(t))).append("circle").attr("class",((t,e)=>`${this.BUBBLE_CLASS} _${e}`)).on("click",w.eventHandler((t=>this.onClick(t)))).classed("dc-tabbable",this._keyboardAccessible).attr("fill",this.getColor).attr("r",0),t=e.merge(t),F(t,this.transitionDuration(),this.transitionDelay()).select("circle."+this.BUBBLE_CLASS).attr("r",(t=>this.bubbleR(t))).attr("opacity",(t=>this.bubbleR(t)>0?1:0)),this._keyboardAccessible&&this._makeKeyboardAccessible(this.onClick),this._doRenderLabel(e),this._doRenderTitles(e),t}_updateNodes(t){F(t,this.transitionDuration(),this.transitionDelay()).attr("transform",(t=>this._bubbleLocator(t))).select("circle."+this.BUBBLE_CLASS).attr("fill",this.getColor).attr("r",(t=>this.bubbleR(t))).attr("opacity",(t=>this.bubbleR(t)>0?1:0)),this.doUpdateLabels(t),this.doUpdateTitles(t)}_removeNodes(t){t.exit().remove()}_bubbleX(t){let e=this.x()(this.keyAccessor()(t));return!isNaN(e)&&isFinite(e)||(e=0),e}_bubbleY(t){let e=this.y()(this.valueAccessor()(t));return!isNaN(e)&&isFinite(e)||(e=0),e}renderBrush(){}redrawBrush(t,e){this.fadeDeselectedArea(t)}}const dt="bubble-overlay",_t="bubble";class ut extends(Z(j)){constructor(t,e){super(),this._g=void 0,this._points=[],this._keyboardAccessible=!1,this.transitionDuration(750),this.transitionDelay(0),this.radiusValueAccessor((t=>t.value)),this.anchor(t,e)}point(t,e,i){return this._points.push({name:t,x:e,y:i}),this}_doRender(){return this._g=this._initOverlayG(),this.r().range([this.MIN_RADIUS,this.width()*this.maxBubbleRelativeSize()]),this._initializeBubbles(),this.fadeDeselectedArea(this.filter()),this}_initOverlayG(){return this._g=this.select("g.bubble-overlay"),this._g.empty()&&(this._g=this.svg().append("g").attr("class",dt)),this._g}_initializeBubbles(){const t=this._mapData();this.calculateRadiusDomain(),this._points.forEach((e=>{const i=this._getNodeG(e,t);let s=i.select("circle.bubble");s.empty()&&(s=i.append("circle").attr("class",_t).classed("dc-tabbable",this._keyboardAccessible).attr("r",0).attr("fill",this.getColor).on("click",w.eventHandler((t=>this.onClick(t))))),this._keyboardAccessible&&this._makeKeyboardAccessible(this.onClick),F(s,this.transitionDuration(),this.transitionDelay()).attr("r",(t=>this.bubbleR(t))),this._doRenderLabel(i),this._doRenderTitles(i)}))}_mapData(){const t={};return this.data().forEach((e=>{t[this.keyAccessor()(e)]=e})),t}_getNodeG(t,e){const i="node "+N.nameToId(t.name);let s=this._g.select("g."+N.nameToId(t.name));return s.empty()&&(s=this._g.append("g").attr("class",i).attr("transform",`translate(${t.x},${t.y})`)),s.datum(e[t.name]),s}_doRedraw(){return this._updateBubbles(),this.fadeDeselectedArea(this.filter()),this}_updateBubbles(){const t=this._mapData();this.calculateRadiusDomain(),this._points.forEach((e=>{const i=this._getNodeG(e,t),s=i.select("circle.bubble");F(s,this.transitionDuration(),this.transitionDelay()).attr("r",(t=>this.bubbleR(t))).attr("fill",this.getColor),this.doUpdateLabels(i),this.doUpdateTitles(i)}))}debug(t){if(t){let t=this.select("g."+A.DEBUG_GROUP_CLASS);t.empty()&&(t=this.svg().append("g").attr("class",A.DEBUG_GROUP_CLASS));const e=t.append("text").attr("x",10).attr("y",20);t.append("rect").attr("width",this.width()).attr("height",this.height()).on("mousemove",w.eventHandler(((i,s)=>{const r=w.pointer(s,t.node()),n=`${r[0]}, ${r[1]}`;e.text(n)})))}else this.selectAll(".debug").remove();return this}}const gt="dc-cbox-item";class pt extends j{constructor(t,e){super(),this._cbox=void 0,this._promptText="Select all",this._multiple=!1,this._inputType="radio",this._promptValue=null,this._uniqueId=N.uniqueId(),this.data((t=>t.all().filter(this._filterDisplayed))),this._filterDisplayed=t=>this.valueAccessor()(t)>0,this._order=(t,e)=>this.keyAccessor()(t)>this.keyAccessor()(e)?1:this.keyAccessor()(t)<this.keyAccessor()(e)?-1:0,this.anchor(t,e)}_doRender(){return this._doRedraw()}_doRedraw(){return this.select("ul").remove(),this._cbox=this.root().append("ul").classed("dc-cbox-group",!0),this._renderOptions(),this.hasFilter()&&this._multiple?this._cbox.selectAll("input").property("checked",(t=>t&&this.filters().indexOf(String(this.keyAccessor()(t)))>=0||!1)):this.hasFilter()&&this._cbox.selectAll("input").property("checked",(t=>!!t&&this.keyAccessor()(t)===this.filter())),this}_renderOptions(){let t=this._cbox.selectAll("li.dc-cbox-item").data(this.data(),(t=>this.keyAccessor()(t)));t.exit().remove(),t=t.enter().append("li").classed(gt,!0).merge(t),t.append("input").attr("type",this._inputType).attr("value",(t=>this.keyAccessor()(t))).attr("name","domain_"+this._uniqueId).attr("id",((t,e)=>`input_${this._uniqueId}_${e}`)),t.append("label").attr("for",((t,e)=>`input_${this._uniqueId}_${e}`)).text(this.title());const e=this;if(this._multiple)this._cbox.append("li").append("input").attr("type","reset").text(this._promptText).on("click",w.eventHandler((function(t,i){return e._onChange(t,i,this)})));else{const t=this._cbox.append("li");t.append("input").attr("type",this._inputType).attr("value",this._promptValue).attr("name","domain_"+this._uniqueId).attr("id",((t,e)=>`input_${this._uniqueId}_all`)).property("checked",!0),t.append("label").attr("for",((t,e)=>`input_${this._uniqueId}_all`)).text(this._promptText)}return this._cbox.selectAll("li.dc-cbox-item").sort(this._order),this._cbox.on("change",w.eventHandler((function(t,i){return e._onChange(t,i,this)}))),t}_onChange(t,e,i){let s;let n;r.select(e.target).datum()?(n=r.select(i).selectAll("input").filter((function(t){if(t)return this.checked})),s=n.nodes().map((t=>t.value)),this._multiple||1!==s.length||(s=s[0])):s=this._promptValue||null,this.onChange(s)}onChange(t){t&&this._multiple?this.replaceFilter([t]):t?this.replaceFilter(t):this.filterAll(),T.trigger((()=>{this.redrawGroup()}))}order(t){return arguments.length?(this._order=t,this):this._order}promptText(t){return arguments.length?(this._promptText=t,this):this._promptText}filterDisplayed(t){return arguments.length?(this._filterDisplayed=t,this):this._filterDisplayed}multiple(t){return arguments.length?(this._multiple=t,this._multiple?this._inputType="checkbox":this._inputType="radio",this):this._multiple}promptValue(t){return arguments.length?(this._promptValue=t,this):this._promptValue}}class yt extends it{constructor(t,e){super(),this._children=[],this._childOptions={},this._shareColors=!1,this._shareTitle=!0,this._alignYAxes=!1,this._rightYAxis=c.axisRight(),this._rightYAxisLabel=0,this._rightYAxisLabelPadding=12,this._rightY=void 0,this._rightAxisGridLines=!1,this._mandatoryAttributes([]),this.transitionDuration(500),this.transitionDelay(0),this.on("filtered.dcjs-composite-chart",(t=>{for(let t=0;t<this._children.length;++t)this._children[t].replaceFilter(this.filter())})),this.anchor(t,e)}_generateG(){const t=super._generateG();for(let t=0;t<this._children.length;++t){const e=this._children[t];this._generateChildG(e,t),e.dimension()||e.dimension(this.dimension()),e.group()||e.group(this.group()),e.chartGroup(this.chartGroup()),e.svg(this.svg()),e.xUnits(this.xUnits()),e.transitionDuration(this.transitionDuration(),this.transitionDelay()),e.parentBrushOn(this.brushOn()),e.brushOn(!1),e.renderTitle(this.renderTitle()),e.elasticX(this.elasticX())}return t}rescale(){return super.rescale(),this._children.forEach((t=>{t.rescale()})),this}resizing(t){return arguments.length?(super.resizing(t),this._children.forEach((e=>{e.resizing(t)})),this):super.resizing()}_prepareYAxis(){const t=0!==this._leftYAxisChildren().length,e=0!==this._rightYAxisChildren().length,i=this._calculateYAxisRanges(t,e);t&&this._prepareLeftYAxis(i),e&&this._prepareRightYAxis(i),this._leftYAxisChildren().length>0&&!this._rightAxisGridLines?this._renderHorizontalGridLinesForAxis(this.g(),this.y(),this.yAxis()):this._rightYAxisChildren().length>0&&this._renderHorizontalGridLinesForAxis(this.g(),this._rightY,this._rightYAxis)}renderYAxis(){0!==this._leftYAxisChildren().length&&(this.renderYAxisAt("y",this.yAxis(),this.margins().left),this.renderYAxisLabel("y",this.yAxisLabel(),-90)),0!==this._rightYAxisChildren().length&&(this.renderYAxisAt("yr",this.rightYAxis(),this.width()-this.margins().right),this.renderYAxisLabel("yr",this.rightYAxisLabel(),90,this.width()-this._rightYAxisLabelPadding))}_calculateYAxisRanges(t,e){let i,s,r,n,a;return t&&(i=this._yAxisMin(),s=this._yAxisMax()),e&&(r=this._rightYAxisMin(),n=this._rightYAxisMax()),this.alignYAxes()&&t&&e&&(a=this._alignYAxisRanges(i,s,r,n)),a||{lyAxisMin:i,lyAxisMax:s,ryAxisMin:r,ryAxisMax:n}}_alignYAxisRanges(t,e,i,s){const r=(s-i)/(e-t);return{lyAxisMin:Math.min(t,i/r),lyAxisMax:Math.max(e,s/r),ryAxisMin:Math.min(i,t*r),ryAxisMax:Math.max(s,e*r)}}_prepareRightYAxis(t){const e=void 0===this.rightY()||this.elasticY(),i=e||this.resizing();void 0===this.rightY()&&this.rightY(h.scaleLinear()),e&&this.rightY().domain([t.ryAxisMin,t.ryAxisMax]),i&&this.rightY().rangeRound([this.yAxisHeight(),0]),this.rightY().range([this.yAxisHeight(),0]),this.rightYAxis(this.rightYAxis().scale(this.rightY()))}_prepareLeftYAxis(t){const e=void 0===this.y()||this.elasticY(),i=e||this.resizing();void 0===this.y()&&this.y(h.scaleLinear()),e&&this.y().domain([t.lyAxisMin,t.lyAxisMax]),i&&this.y().rangeRound([this.yAxisHeight(),0]),this.y().range([this.yAxisHeight(),0]),this.yAxis(this.yAxis().scale(this.y()))}_generateChildG(t,e){t._generateG(this.g()),t.g().attr("class","sub _"+e)}plotData(){for(let t=0;t<this._children.length;++t){const e=this._children[t];e.g()||this._generateChildG(e,t),this._shareColors&&e.colors(this.colors()),e.x(this.x()),e.xAxis(this.xAxis()),e.useRightYAxis()?(e.y(this.rightY()),e.yAxis(this.rightYAxis())):(e.y(this.y()),e.yAxis(this.yAxis())),e.plotData(),e._activateRenderlets()}}useRightAxisGridLines(t){return arguments?(this._rightAxisGridLines=t,this):this._rightAxisGridLines}childOptions(t){return arguments.length?(this._childOptions=t,this._children.forEach((t=>{t.options(this._childOptions)})),this):this._childOptions}fadeDeselectedArea(t){if(this.brushOn())for(let e=0;e<this._children.length;++e){this._children[e].fadeDeselectedArea(t)}}rightYAxisLabel(t,e){return arguments.length?(this._rightYAxisLabel=t,this.margins().right-=this._rightYAxisLabelPadding,this._rightYAxisLabelPadding=void 0===e?12:e,this.margins().right+=this._rightYAxisLabelPadding,this):this._rightYAxisLabel}compose(t){return this._children=t,this._children.forEach((t=>{t.height(this.height()),t.width(this.width()),t.margins(this.margins()),this._shareTitle&&t.title(this.title()),t.options(this._childOptions)})),this.rescale(),this}_setChildrenProperty(t,e){this._children.forEach((i=>{i[t](e)}))}height(t){return arguments.length?(super.height(t),this._setChildrenProperty("height",t),this):super.height()}width(t){return arguments.length?(super.width(t),this._setChildrenProperty("width",t),this):super.width()}margins(t){return arguments.length?(super.margins(t),this._setChildrenProperty("margins",t),this):super.margins()}children(){return this._children}shareColors(t){return arguments.length?(this._shareColors=t,this):this._shareColors}shareTitle(t){return arguments.length?(this._shareTitle=t,this):this._shareTitle}rightY(t){return arguments.length?(this._rightY=t,this.rescale(),this):this._rightY}alignYAxes(t){return arguments.length?(this._alignYAxes=t,this.rescale(),this):this._alignYAxes}_leftYAxisChildren(){return this._children.filter((t=>!t.useRightYAxis()))}_rightYAxisChildren(){return this._children.filter((t=>t.useRightYAxis()))}_getYAxisMin(t){return t.map((t=>t.yAxisMin()))}_yAxisMin(){return a.min(this._getYAxisMin(this._leftYAxisChildren()))}_rightYAxisMin(){return a.min(this._getYAxisMin(this._rightYAxisChildren()))}_getYAxisMax(t){return t.map((t=>t.yAxisMax()))}_yAxisMax(){return N.add(a.max(this._getYAxisMax(this._leftYAxisChildren())),this.yAxisPadding())}_rightYAxisMax(){return N.add(a.max(this._getYAxisMax(this._rightYAxisChildren())),this.yAxisPadding())}_getAllXAxisMinFromChildCharts(){return this._children.map((t=>t.xAxisMin()))}xAxisMin(){return N.subtract(a.min(this._getAllXAxisMinFromChildCharts()),this.xAxisPadding(),this.xAxisPaddingUnit())}_getAllXAxisMaxFromChildCharts(){return this._children.map((t=>t.xAxisMax()))}xAxisMax(){return N.add(a.max(this._getAllXAxisMaxFromChildCharts()),this.xAxisPadding(),this.xAxisPaddingUnit())}legendables(){return this._children.reduce(((t,e)=>(this._shareColors&&e.colors(this.colors()),t.push.apply(t,e.legendables()),t)),[])}legendHighlight(t){for(let e=0;e<this._children.length;++e){this._children[e].legendHighlight(t)}}legendReset(t){for(let e=0;e<this._children.length;++e){this._children[e].legendReset(t)}}legendToggle(){console.log("composite should not be getting legendToggle itself")}rightYAxis(t){return arguments.length?(this._rightYAxis=t,this):this._rightYAxis}yAxisMin(){throw new Error("Not supported for this chart type")}yAxisMax(){throw new Error("Not supported for this chart type")}}class mt extends j{constructor(t,e){super(),this._formatNumber=s.format(",d"),this._crossfilter=null,this._groupAll=null,this._html={some:"",all:""},this._mandatoryAttributes(["crossfilter","groupAll"]),this.anchor(t,e)}html(t){return arguments.length?(t.all&&(this._html.all=t.all),t.some&&(this._html.some=t.some),this):this._html}formatNumber(t){return arguments.length?(this._formatNumber=t,this):this._formatNumber}_doRender(){const t=this.crossfilter().size(),e=this.groupAll().value(),i=this._formatNumber(t),s=this._formatNumber(e);return t===e&&""!==this._html.all?this.root().html(this._html.all.replace("%total-count",i).replace("%filter-count",s)):""!==this._html.some?this.root().html(this._html.some.replace("%total-count",i).replace("%filter-count",s)):(this.selectAll(".total-count").text(i),this.selectAll(".filter-count").text(s)),this}_doRedraw(){return this._doRender()}crossfilter(t){return arguments.length?(this._crossfilter=t,this):this._crossfilter}dimension(t){return C.warnOnce("consider using dataCount.crossfilter instead of dataCount.dimension for clarity"),arguments.length?this.crossfilter(t):this.crossfilter()}groupAll(t){return arguments.length?(this._groupAll=t,this):this._groupAll}group(t){return C.warnOnce("consider using dataCount.groupAll instead of dataCount.group for clarity"),arguments.length?this.groupAll(t):this.groupAll()}}const xt="dc-grid-item",ft="dc-grid-top";class bt extends j{constructor(t,e){super(),this._section=null,this._size=999,this._html=function(t){return"you need to provide an html() handling param:  "+JSON.stringify(t)},this._sortBy=function(t){return t},this._order=a.ascending,this._beginSlice=0,this._endSlice=void 0,this._htmlSection=t=>`<div class='dc-grid-section dc-grid-group'><h1 class='dc-grid-label'>${this.keyAccessor()(t)}</h1></div>`,this._mandatoryAttributes(["dimension","section"]),this.anchor(t,e)}_doRender(){return this.selectAll("div.dc-grid-top").remove(),this._renderItems(this._renderSections()),this}_renderSections(){const t=this.root().selectAll("div.dc-grid-top").data(this._nestEntries(),(t=>this.keyAccessor()(t))),e=t.enter().append("div").attr("class",ft);return this._htmlSection&&e.html((t=>this._htmlSection(t))),t.exit().remove(),e}_nestEntries(){let t=this.dimension().top(this._size);return t=t.sort(((t,e)=>this._order(this._sortBy(t),this._sortBy(e)))).slice(this._beginSlice,this._endSlice),w.nester({key:this.section(),sortKeys:this._order,entries:t})}_renderItems(t){let e=t.order().selectAll("div.dc-grid-item").data((t=>t.values));return e.exit().remove(),e=e.enter().append("div").attr("class",xt).html((t=>this._html(t))).merge(e),e}_doRedraw(){return this._doRender()}section(t){return arguments.length?(this._section=t,this):this._section}group(t){return C.warnOnce("consider using dataGrid.section instead of dataGrid.group for clarity"),arguments.length?this.section(t):this.section()}beginSlice(t){return arguments.length?(this._beginSlice=t,this):this._beginSlice}endSlice(t){return arguments.length?(this._endSlice=t,this):this._endSlice}size(t){return arguments.length?(this._size=t,this):this._size}html(t){return arguments.length?(this._html=t,this):this._html}htmlSection(t){return arguments.length?(this._htmlSection=t,this):this._htmlSection}htmlGroup(t){return C.warnOnce("consider using dataGrid.htmlSection instead of dataGrid.htmlGroup for clarity"),arguments.length?this.htmlSection(t):this.htmlSection()}sortBy(t){return arguments.length?(this._sortBy=t,this):this._sortBy}order(t){return arguments.length?(this._order=t,this):this._order}}const At="dc-table-row";class vt extends j{constructor(t,e){super(),this._size=25,this._columns=[],this._sortBy=t=>t,this._order=a.ascending,this._beginSlice=0,this._endSlice=void 0,this._showSections=!0,this._section=()=>"",this._mandatoryAttributes(["dimension"]),this.anchor(t,e)}_doRender(){return this.selectAll("tbody").remove(),this._renderRows(this._renderSections()),this}_doColumnValueFormat(t,e){return"function"==typeof t?t(e):"string"==typeof t?e[t]:t.format(e)}_doColumnHeaderFormat(t){return"function"==typeof t?this._doColumnHeaderFnToString(t):"string"==typeof t?this._doColumnHeaderCapitalize(t):String(t.label)}_doColumnHeaderCapitalize(t){return t.charAt(0).toUpperCase()+t.slice(1)}_doColumnHeaderFnToString(t){let e=String(t);const i=e.indexOf("return ");if(i>=0){const t=e.lastIndexOf(";");if(t>=0){e=e.substring(i+7,t);e.indexOf("numberFormat")>=0&&(e=e.replace("numberFormat",""))}}return e}_renderSections(){let t=!0;if(this._columns.forEach((e=>{t&="function"==typeof e})),!t){let t=this.selectAll("thead").data([0]);t.exit().remove(),t=t.enter().append("thead").merge(t);let e=t.selectAll("tr").data([0]);e.exit().remove(),e=e.enter().append("tr").merge(e);const i=e.selectAll("th").data(this._columns);i.exit().remove(),i.enter().append("th").merge(i).attr("class","dc-table-head").html((t=>this._doColumnHeaderFormat(t)))}const e=this.root().selectAll("tbody").data(this._nestEntries(),(t=>this.keyAccessor()(t))),i=e.enter().append("tbody");return!0===this._showSections&&i.append("tr").attr("class","dc-table-section dc-table-group").append("td").attr("class","dc-table-label").attr("colspan",this._columns.length).html((t=>this.keyAccessor()(t))),e.exit().remove(),i}_nestEntries(){let t;return t=this._order===a.ascending?this.dimension().bottom(this._size):this.dimension().top(this._size),t=t.sort(((t,e)=>this._order(this._sortBy(t),this._sortBy(e)))).slice(this._beginSlice,this._endSlice),w.nester({key:this.section(),sortKeys:this._order,entries:t})}_renderRows(t){const e=t.order().selectAll("tr.dc-table-row").data((t=>t.values)),i=e.enter().append("tr").attr("class",At);return this._columns.forEach(((t,e)=>{i.append("td").attr("class","dc-table-column _"+e).html((e=>this._doColumnValueFormat(t,e)))})),e.exit().remove(),e}_doRedraw(){return this._doRender()}section(t){return arguments.length?(this._section=t,this):this._section}group(t){return C.warnOnce("consider using dataTable.section instead of dataTable.group for clarity"),arguments.length?this.section(t):this.section()}size(t){return arguments.length?(this._size=t,this):this._size}beginSlice(t){return arguments.length?(this._beginSlice=t,this):this._beginSlice}endSlice(t){return arguments.length?(this._endSlice=t,this):this._endSlice}columns(t){return arguments.length?(this._columns=t,this):this._columns}sortBy(t){return arguments.length?(this._sortBy=t,this):this._sortBy}order(t){return arguments.length?(this._order=t,this):this._order}showSections(t){return arguments.length?(this._showSections=t,this):this._showSections}showGroups(t){return C.warnOnce("consider using dataTable.showSections instead of dataTable.showGroups for clarity"),arguments.length?this.showSections(t):this.showSections()}}class Ct extends(K(j)){constructor(t,e){super(),this.colorAccessor((t=>t||0)),this._geoPath=p.geoPath(),this._projectionFlag=void 0,this._projection=void 0,this._geoJsons=[],this.anchor(t,e)}_doRender(){this.resetSvg();for(let t=0;t<this._geoJsons.length;++t){let e=this.svg().append("g").attr("class","layer"+t).selectAll("g."+this._geoJson(t).name).data(this._geoJson(t).data);e=e.enter().append("g").attr("class",this._geoJson(t).name).merge(e),e.append("path").classed("dc-tabbable",this._keyboardAccessible).attr("fill","white").attr("d",this._getGeoPath()),e.append("title"),this._plotData(t)}this._projectionFlag=!1}_plotData(t){const e=this._generateLayeredData();if(this._isDataLayer(t)){const i=this._renderRegionG(t);this._renderPaths(i,t,e),this._renderTitles(i,t,e)}}_generateLayeredData(){const t={},e=this.data();for(let i=0;i<e.length;++i)t[this.keyAccessor()(e[i])]=this.valueAccessor()(e[i]);return t}_isDataLayer(t){return this._geoJson(t).keyAccessor}_renderRegionG(t){return this.svg().selectAll(this._layerSelector(t)).classed("selected",(e=>this._isSelected(t,e))).classed("deselected",(e=>this._isDeselected(t,e))).attr("class",(e=>{let i=`${this._geoJson(t).name} ${N.nameToId(this._geoJson(t).keyAccessor(e))}`;return this._isSelected(t,e)&&(i+=" selected"),this._isDeselected(t,e)&&(i+=" deselected"),i}))}_layerSelector(t){return`g.layer${t} g.${this._geoJson(t).name}`}_isSelected(t,e){return this.hasFilter()&&this.hasFilter(this._getKey(t,e))}_isDeselected(t,e){return this.hasFilter()&&!this.hasFilter(this._getKey(t,e))}_getKey(t,e){return this._geoJson(t).keyAccessor(e)}_geoJson(t){return this._geoJsons[t]}_renderPaths(t,e,i){const s=t.select("path").attr("fill",(function(){const t=r.select(this).attr("fill");return t||"none"})).on("click",w.eventHandler((t=>this.onClick(t,e))));this._keyboardAccessible&&this._makeKeyboardAccessible(this.onClick,e),F(s,this.transitionDuration(),this.transitionDelay()).attr("fill",((t,s)=>this.getColor(i[this._geoJson(e).keyAccessor(t)],s)))}onClick(t,e){const i=this._geoJson(e).keyAccessor(t);T.trigger((()=>{this.filter(i),this.redrawGroup()}))}_renderTitles(t,e,i){this.renderTitle()&&t.selectAll("title").text((t=>{const s=this._getKey(e,t),r=i[s];return this.title()({key:s,value:r})}))}_doRedraw(){for(let t=0;t<this._geoJsons.length;++t)this._plotData(t),this._projectionFlag&&this.svg().selectAll(`g.${this._geoJson(t).name} path`).attr("d",this._getGeoPath());this._projectionFlag=!1}overlayGeoJson(t,e,i){for(let s=0;s<this._geoJsons.length;++s)if(this._geoJsons[s].name===e)return this._geoJsons[s].data=t,this._geoJsons[s].keyAccessor=i,this;return this._geoJsons.push({name:e,data:t,keyAccessor:i}),this}projection(t){return arguments.length?(this._projection=t,this._projectionFlag=!0,this):this._projection}_getGeoPath(){return void 0===this._projection?(C.warn("choropleth projection default of geoAlbers is deprecated, in next version projection will need to be set explicitly"),this._geoPath.projection(p.geoAlbersUsa())):this._geoPath.projection(this._projection)}geoJsons(){return this._geoJsons}geoPath(){return this._geoPath}removeGeoJson(t){const e=[];for(let i=0;i<this._geoJsons.length;++i){const s=this._geoJsons[i];s.name!==t&&e.push(s)}return this._geoJsons=e,this}}class kt extends(K(Q)){constructor(t,e){super(),this._chartBody=void 0,this._cols=void 0,this._rows=void 0,this._colOrdering=a.ascending,this._rowOrdering=a.ascending,this._colScale=h.scaleBand(),this._rowScale=h.scaleBand(),this._xBorderRadius=6.75,this._yBorderRadius=6.75,this._mandatoryAttributes(["group"]),this.title(this.colorAccessor()),this._colsLabel=t=>t,this._rowsLabel=t=>t,this._xAxisOnClick=t=>{this._filterAxis(0,t)},this._yAxisOnClick=t=>{this._filterAxis(1,t)},this._boxOnClick=t=>{const e=t.key;T.trigger((()=>{this.filter(E.TwoDimensionalFilter(e)),this.redrawGroup()}))},this.anchor(t,e)}colsLabel(t){return arguments.length?(this._colsLabel=t,this):this._colsLabel}rowsLabel(t){return arguments.length?(this._rowsLabel=t,this):this._rowsLabel}_filterAxis(t,e){const i=this.selectAll(".box-group").filter((i=>i.key[t]===e)),s=i.filter((t=>!this.hasFilter(t.key)));T.trigger((()=>{const t=(s.empty()?i:s).data().map((t=>E.TwoDimensionalFilter(t.key)));this.filter([t]),this.redrawGroup()}))}filter(t){const e=t=>(C.warnOnce("heatmap.filter taking a coordinate is deprecated - please pass dc.filters.TwoDimensionalFilter instead"),this._filter(E.TwoDimensionalFilter(t)));return arguments.length?null===t||"TwoDimensionalFilter"===t.filterType||Array.isArray(t)&&Array.isArray(t[0])&&"TwoDimensionalFilter"===t[0][0].filterType?super.filter(t):e(t):super.filter()}rows(t){return arguments.length?(this._rows=t,this):this._rows}rowOrdering(t){return arguments.length?(this._rowOrdering=t,this):this._rowOrdering}cols(t){return arguments.length?(this._cols=t,this):this._cols}colOrdering(t){return arguments.length?(this._colOrdering=t,this):this._colOrdering}_doRender(){return this.resetSvg(),this._chartBody=this.svg().append("g").attr("class","heatmap").attr("transform",`translate(${this.margins().left},${this.margins().top})`),this._doRedraw()}_doRedraw(){const t=this.data();let e=this.rows()||t.map(this.valueAccessor()),i=this.cols()||t.map(this.keyAccessor());this._rowOrdering&&(e=e.sort(this._rowOrdering)),this._colOrdering&&(i=i.sort(this._colOrdering)),e=this._rowScale.domain(e),i=this._colScale.domain(i);const s=e.domain().length,r=i.domain().length,n=Math.floor(this.effectiveWidth()/r),a=Math.floor(this.effectiveHeight()/s);i.rangeRound([0,this.effectiveWidth()]),e.rangeRound([this.effectiveHeight(),0]);let h=this._chartBody.selectAll("g.box-group").data(this.data(),((t,e)=>`${this.keyAccessor()(t,e)}\0${this.valueAccessor()(t,e)}`));h.exit().remove();const l=h.enter().append("g").attr("class","box-group");l.append("rect").attr("class","heat-box").classed("dc-tabbable",this._keyboardAccessible).attr("fill","white").attr("x",((t,e)=>i(this.keyAccessor()(t,e)))).attr("y",((t,i)=>e(this.valueAccessor()(t,i)))).on("click",w.eventHandler(this.boxOnClick())),this._keyboardAccessible&&this._makeKeyboardAccessible(this.boxOnClick),h=l.merge(h),this.renderTitle()&&(l.append("title"),h.select("title").text(this.title())),F(h.select("rect"),this.transitionDuration(),this.transitionDelay()).attr("x",((t,e)=>i(this.keyAccessor()(t,e)))).attr("y",((t,i)=>e(this.valueAccessor()(t,i)))).attr("rx",this._xBorderRadius).attr("ry",this._yBorderRadius).attr("fill",this.getColor).attr("width",n).attr("height",a);let o=this._chartBody.select("g.cols");o.empty()&&(o=this._chartBody.append("g").attr("class","cols axis"));let c=o.selectAll("text").data(i.domain());c.exit().remove(),c=c.enter().append("text").attr("x",(t=>i(t)+n/2)).style("text-anchor","middle").attr("y",this.effectiveHeight()).attr("dy",12).on("click",w.eventHandler(this.xAxisOnClick())).text(this.colsLabel()).merge(c),F(c,this.transitionDuration(),this.transitionDelay()).text(this.colsLabel()).attr("x",(t=>i(t)+n/2)).attr("y",this.effectiveHeight());let d=this._chartBody.select("g.rows");d.empty()&&(d=this._chartBody.append("g").attr("class","rows axis"));let _=d.selectAll("text").data(e.domain());if(_.exit().remove(),_=_.enter().append("text").style("text-anchor","end").attr("x",0).attr("dx",-2).attr("y",(t=>e(t)+a/2)).attr("dy",6).on("click",w.eventHandler(this.yAxisOnClick())).text(this.rowsLabel()).merge(_),F(_,this.transitionDuration(),this.transitionDelay()).text(this.rowsLabel()).attr("y",(t=>e(t)+a/2)),this.hasFilter()){const t=this;this.selectAll("g.box-group").each((function(e){t.isSelectedNode(e)?t.highlightSelected(this):t.fadeDeselected(this)}))}else{const t=this;this.selectAll("g.box-group").each((function(){t.resetHighlight(this)}))}return this}boxOnClick(t){return arguments.length?(this._boxOnClick=t,this):this._boxOnClick}xAxisOnClick(t){return arguments.length?(this._xAxisOnClick=t,this):this._xAxisOnClick}yAxisOnClick(t){return arguments.length?(this._yAxisOnClick=t,this):this._yAxisOnClick}xBorderRadius(t){return arguments.length?(this._xBorderRadius=t,this):this._xBorderRadius}yBorderRadius(t){return arguments.length?(this._yBorderRadius=t,this):this._yBorderRadius}isSelectedNode(t){return this.hasFilter(t.key)}}class St{constructor(){this._htmlLegendDivCssClass="dc-html-legend",this._legendItemCssClassHorizontal="dc-legend-item-horizontal",this._legendItemCssClassVertical="dc-legend-item-vertical",this._parent=void 0,this._container=void 0,this._legendText=M("name"),this._maxItems=void 0,this._horizontal=!1,this._legendItemClass=void 0,this._highlightSelected=!1,this._keyboardAccessible=!1}parent(t){return arguments.length?(this._parent=t,this):this._parent}render(){this._defaultLegendItemCssClass=this._horizontal?this._legendItemCssClassHorizontal:this._legendItemCssClassVertical,this._container.select("div."+this._htmlLegendDivCssClass).remove();const t=this._container.append("div").attr("class",this._htmlLegendDivCssClass);t.attr("style","max-width:"+this._container.nodes()[0].style.width);let e=this._parent.legendables();const i=this._parent.filters();void 0!==this._maxItems&&(e=e.slice(0,this._maxItems));const s=this._legendItemClass?this._legendItemClass:this._defaultLegendItemCssClass,r=t.selectAll("div."+s).data(e).enter().append("div").classed(s,!0).on("mouseover",w.eventHandler((t=>this._parent.legendHighlight(t)))).on("mouseout",w.eventHandler((t=>this._parent.legendReset(t)))).on("click",w.eventHandler((t=>this._parent.legendToggle(t))));this._highlightSelected&&r.classed(A.SELECTED_CLASS,(t=>-1!==i.indexOf(t.name))),r.append("span").attr("class","dc-legend-item-color").style("background-color",M("color")),r.append("span").attr("class","dc-legend-item-label").classed("dc-tabbable",this._keyboardAccessible).attr("title",this._legendText).text(this._legendText),this._keyboardAccessible&&this._makeLegendKeyboardAccessible()}container(t){return arguments.length?(this._container=r.select(t),this):this._container}legendItemClass(t){return arguments.length?(this._legendItemClass=t,this):this._legendItemClass}highlightSelected(t){return arguments.length?(this._highlightSelected=t,this):this._highlightSelected}horizontal(t){return arguments.length?(this._horizontal=t,this):this._horizontal}legendText(t){return arguments.length?(this._legendText=t,this):this._legendText}maxItems(t){return arguments.length?(this._maxItems=N.isNumber(t)?t:void 0,this):this._maxItems}keyboardAccessible(t){return arguments.length?(this._keyboardAccessible=t,this):this._keyboardAccessible}_makeLegendKeyboardAccessible(){this._parent._svgDescription||(this._parent.svg().append("desc").attr("id","desc-id-"+this._parent.__dcFlag__).html(""+this._parent.svgDescription()),this._parent.svg().attr("tabindex","0").attr("role","img").attr("aria-labelledby","desc-id-"+this._parent.__dcFlag__));this.container().selectAll(".dc-legend-item-label.dc-tabbable").attr("tabindex",0).on("keydown",w.eventHandler(((t,e)=>{13===e.keyCode&&"object"==typeof t&&t.chart.legendToggle(t),32===e.keyCode&&"object"==typeof t&&(t.chart.legendToggle(t),e.preventDefault())}))).on("focus",w.eventHandler((t=>{this._parent.legendHighlight(t)}))).on("blur",w.eventHandler((t=>{this._parent.legendReset(t)})))}}class wt{constructor(){this._parent=void 0,this._x=0,this._y=0,this._itemHeight=12,this._gap=5,this._horizontal=!1,this._legendWidth=560,this._itemWidth=70,this._autoItemWidth=!1,this._legendText=M("name"),this._maxItems=void 0,this._highlightSelected=!1,this._keyboardAccessible=!1,this._g=void 0}parent(t){return arguments.length?(this._parent=t,this):this._parent}x(t){return arguments.length?(this._x=t,this):this._x}y(t){return arguments.length?(this._y=t,this):this._y}gap(t){return arguments.length?(this._gap=t,this):this._gap}highlightSelected(t){return arguments.length?(this._highlightSelected=t,this):this._highlightSelected}itemHeight(t){return arguments.length?(this._itemHeight=t,this):this._itemHeight}horizontal(t){return arguments.length?(this._horizontal=t,this):this._horizontal}legendWidth(t){return arguments.length?(this._legendWidth=t,this):this._legendWidth}itemWidth(t){return arguments.length?(this._itemWidth=t,this):this._itemWidth}autoItemWidth(t){return arguments.length?(this._autoItemWidth=t,this):this._autoItemWidth}legendText(t){return arguments.length?(this._legendText=t,this):this._legendText}maxItems(t){return arguments.length?(this._maxItems=N.isNumber(t)?t:void 0,this):this._maxItems}keyboardAccessible(t){return arguments.length?(this._keyboardAccessible=t,this):this._keyboardAccessible}_legendItemHeight(){return this._gap+this._itemHeight}_makeLegendKeyboardAccessible(){this._parent._svgDescription||(this._parent.svg().append("desc").attr("id","desc-id-"+this._parent.__dcFlag__).html(""+this._parent.svgDescription()),this._parent.svg().attr("tabindex","0").attr("role","img").attr("aria-labelledby","desc-id-"+this._parent.__dcFlag__));this._parent.svg().selectAll(".dc-legend .dc-tabbable").attr("tabindex",0).on("keydown",w.eventHandler(((t,e)=>{13===e.keyCode&&"object"==typeof t&&t.chart.legendToggle(t),32===e.keyCode&&"object"==typeof t&&(t.chart.legendToggle(t),e.preventDefault())}))).on("focus",w.eventHandler((t=>{this._parent.legendHighlight(t)}))).on("blur",w.eventHandler((t=>{this._parent.legendReset(t)})))}render(){this._parent.svg().select("g.dc-legend").remove(),this._g=this._parent.svg().append("g").attr("class","dc-legend").attr("transform",`translate(${this._x},${this._y})`);let t=this._parent.legendables();const e=this._parent.filters();void 0!==this._maxItems&&(t=t.slice(0,this._maxItems));const i=this._g.selectAll("g.dc-legend-item").data(t).enter().append("g").attr("class","dc-legend-item").on("mouseover",w.eventHandler((t=>{this._parent.legendHighlight(t)}))).on("mouseout",w.eventHandler((t=>{this._parent.legendReset(t)}))).on("click",w.eventHandler((t=>{t.chart.legendToggle(t)})));this._highlightSelected&&i.classed(A.SELECTED_CLASS,(t=>-1!==e.indexOf(t.name))),this._g.selectAll("g.dc-legend-item").classed("fadeout",(t=>t.chart.isLegendableHidden(t))),t.some(M("dashstyle"))?i.append("line").attr("x1",0).attr("y1",this._itemHeight/2).attr("x2",this._itemHeight).attr("y2",this._itemHeight/2).attr("stroke-width",2).attr("stroke-dasharray",M("dashstyle")).attr("stroke",M("color")):i.append("rect").attr("width",this._itemHeight).attr("height",this._itemHeight).attr("fill",(t=>t?t.color:"blue"));{const t=this;i.append("text").text(t._legendText).classed("dc-tabbable",this._keyboardAccessible).attr("x",t._itemHeight+2).attr("y",(function(){return t._itemHeight/2+(this.clientHeight?this.clientHeight:13)/2-2})),this._keyboardAccessible&&this._makeLegendKeyboardAccessible()}let s=0,r=0;{const t=this;i.attr("transform",(function(e,i){if(t._horizontal){const e=!0===t._autoItemWidth?this.getBBox().width+t._gap:t._itemWidth;s+e>t._legendWidth&&s>0&&(++r,s=0);const i=`translate(${s},${r*t._legendItemHeight()})`;return s+=e,i}return`translate(0,${i*t._legendItemHeight()})`}))}}}const Lt="yRef",Rt="xRef",Dt=1e-6;class Ot extends at{constructor(t,e){super(),this._renderArea=!1,this._dotRadius=5,this._dataPointRadius=null,this._dataPointFillOpacity=Dt,this._dataPointStrokeOpacity=Dt,this._curve=null,this._interpolate=null,this._tension=null,this._defined=void 0,this._dashStyle=void 0,this._xyTipsOn=!0,this.transitionDuration(500),this.transitionDelay(0),this._rangeBandPadding(1),this.label((t=>N.printSingleValue(t.y0+t.y)),!1),this.anchor(t,e)}plotData(){const t=this.chartBodyG();let e=t.select("g.stack-list");e.empty()&&(e=t.append("g").attr("class","stack-list"));let i=e.selectAll("g.stack").data(this.data());const s=i.enter().append("g").attr("class",((t,e)=>"stack _"+e));i=s.merge(i),this._drawLine(s,i),this._drawArea(s,i),this._drawDots(t,i),this.renderLabel()&&this._drawLabels(i)}curve(t){return arguments.length?(this._curve=t,this):this._curve}interpolate(t){return C.warnOnce("dc.lineChart.interpolate has been deprecated since version 3.0 use dc.lineChart.curve instead"),arguments.length?(this._interpolate=t,this):this._interpolate}tension(t){return C.warnOnce("dc.lineChart.tension has been deprecated since version 3.0 use dc.lineChart.curve instead"),arguments.length?(this._tension=t,this):this._tension}defined(t){return arguments.length?(this._defined=t,this):this._defined}dashStyle(t){return arguments.length?(this._dashStyle=t,this):this._dashStyle}renderArea(t){return arguments.length?(this._renderArea=t,this):this._renderArea}_getColor(t,e){return this.getColor.call(t,t.values,e)}_getCurveFactory(){let t=null;if(this._curve)return this._curve;if("function"==typeof this._interpolate)t=this._interpolate;else{t={linear:g.curveLinear,"linear-closed":g.curveLinearClosed,step:g.curveStep,"step-before":g.curveStepBefore,"step-after":g.curveStepAfter,basis:g.curveBasis,"basis-open":g.curveBasisOpen,"basis-closed":g.curveBasisClosed,bundle:g.curveBundle,cardinal:g.curveCardinal,"cardinal-open":g.curveCardinalOpen,"cardinal-closed":g.curveCardinalClosed,monotone:g.curveMonotoneX}[this._interpolate]}return t||(t=g.curveLinear),null!==this._tension&&("function"!=typeof t.tension?C.warn("tension was specified but the curve/interpolate does not support it."):t=t.tension(this._tension)),t}_drawLine(t,e){const i=g.line().x((t=>this.x()(t.x))).y((t=>this.y()(t.y+t.y0))).curve(this._getCurveFactory());this._defined&&i.defined(this._defined);const s=t.append("path").attr("class","line").attr("stroke",((t,e)=>this._getColor(t,e)));this._dashStyle&&s.attr("stroke-dasharray",this._dashStyle),F(e.select("path.line"),this.transitionDuration(),this.transitionDelay()).attr("stroke",((t,e)=>this._getColor(t,e))).attr("d",(t=>this._safeD(i(t.values))))}_drawArea(t,e){if(this._renderArea){const i=g.area().x((t=>this.x()(t.x))).y1((t=>this.y()(t.y+t.y0))).y0((t=>this.y()(t.y0))).curve(this._getCurveFactory());this._defined&&i.defined(this._defined),t.append("path").attr("class","area").attr("fill",((t,e)=>this._getColor(t,e))).attr("d",(t=>this._safeD(i(t.values)))),F(e.select("path.area"),this.transitionDuration(),this.transitionDelay()).attr("fill",((t,e)=>this._getColor(t,e))).attr("d",(t=>this._safeD(i(t.values))))}}_safeD(t){return!t||t.indexOf("NaN")>=0?"M0,0":t}_drawDots(t,e){if("always"===this.xyTipsOn()||!this.brushOn()&&!this.parentBrushOn()&&this.xyTipsOn()){const i="dc-tooltip-list";let s=t.select("g."+i);s.empty()&&(s=t.append("g").attr("class",i)),e.each(((t,e)=>{let i=t.values;this._defined&&(i=i.filter(this._defined));let n=s.select("g.dc-tooltip._"+e);n.empty()&&(n=s.append("g").attr("class","dc-tooltip _"+e)),this._createRefLines(n);const a=n.selectAll("circle.dot").data(i,M("x")),h=this,l=a.enter().append("circle").attr("class","dot").classed("dc-tabbable",this._keyboardAccessible).attr("cx",(t=>N.safeNumber(this.x()(t.x)))).attr("cy",(t=>N.safeNumber(this.y()(t.y+t.y0)))).attr("r",this._getDotRadius()).style("fill-opacity",this._dataPointFillOpacity).style("stroke-opacity",this._dataPointStrokeOpacity).attr("fill",this.getColor).attr("stroke",this.getColor).on("mousemove",(function(){const t=r.select(this);h._showDot(t),h._showRefLines(t,n)})).on("mouseout",(function(){const t=r.select(this);h._hideDot(t),h._hideRefLines(n)})).merge(a);this._keyboardAccessible&&this._svg.selectAll(".dc-tabbable").attr("tabindex",0).on("focus",(function(){const t=r.select(this);h._showDot(t),h._showRefLines(t,n)})).on("blur",(function(){const t=r.select(this);h._hideDot(t),h._hideRefLines(n)})),l.call((e=>this._doRenderTitle(e,t))),F(l,this.transitionDuration()).attr("cx",(t=>N.safeNumber(this.x()(t.x)))).attr("cy",(t=>N.safeNumber(this.y()(t.y+t.y0)))).attr("fill",this.getColor),a.exit().remove()}))}}_drawLabels(t){const e=this;t.each((function(t,i){const s=r.select(this).selectAll("text.lineLabel").data(t.values,M("x")),n=s.enter().append("text").attr("class","lineLabel").attr("text-anchor","middle").merge(s);F(n,e.transitionDuration()).attr("x",(t=>N.safeNumber(e.x()(t.x)))).attr("y",(t=>{const i=e.y()(t.y+t.y0)-3;return N.safeNumber(i)})).text((t=>e.label()(t))),F(s.exit(),e.transitionDuration()).attr("height",0).remove()}))}_createRefLines(t){(t.select("path.yRef").empty()?t.append("path").attr("class",Lt):t.select("path.yRef")).style("display","none").attr("stroke-dasharray","5,5");(t.select("path.xRef").empty()?t.append("path").attr("class",Rt):t.select("path.xRef")).style("display","none").attr("stroke-dasharray","5,5")}_showDot(t){return t.style("fill-opacity",.8),t.style("stroke-opacity",.8),t.attr("r",this._dotRadius),t}_showRefLines(t,e){const i=t.attr("cx"),s=t.attr("cy"),r=`M${this._yAxisX()-this.margins().left} ${s}L${i} ${s}`,n=`M${i} ${this.yAxisHeight()}L${i} ${s}`;e.select("path.yRef").style("display","").attr("d",r),e.select("path.xRef").style("display","").attr("d",n)}_getDotRadius(){return this._dataPointRadius||this._dotRadius}_hideDot(t){t.style("fill-opacity",this._dataPointFillOpacity).style("stroke-opacity",this._dataPointStrokeOpacity).attr("r",this._getDotRadius())}_hideRefLines(t){t.select("path.yRef").style("display","none"),t.select("path.xRef").style("display","none")}_doRenderTitle(t,e){this.renderTitle()&&(t.select("title").remove(),t.append("title").text(M("data",this.title(e.name))))}xyTipsOn(t){return arguments.length?(this._xyTipsOn=t,this):this._xyTipsOn}dotRadius(t){return arguments.length?(this._dotRadius=t,this):this._dotRadius}renderDataPoints(t){return arguments.length?(t?(this._dataPointFillOpacity=t.fillOpacity||.8,this._dataPointStrokeOpacity=t.strokeOpacity||0,this._dataPointRadius=t.radius||2):(this._dataPointFillOpacity=Dt,this._dataPointStrokeOpacity=Dt,this._dataPointRadius=null),this):{fillOpacity:this._dataPointFillOpacity,strokeOpacity:this._dataPointStrokeOpacity,radius:this._dataPointRadius}}_colorFilter(t,e,i){return function(){const s=r.select(this),n=s.attr("stroke")===t&&s.attr("stroke-dasharray")===(e instanceof Array?e.join(","):null)||s.attr("fill")===t;return i?!n:n}}legendHighlight(t){this.isLegendableHidden(t)||this.g().selectAll("path.line, path.area").classed("highlight",this._colorFilter(t.color,t.dashstyle)).classed("fadeout",this._colorFilter(t.color,t.dashstyle,!0))}legendReset(){this.g().selectAll("path.line, path.area").classed("highlight",!1).classed("fadeout",!1)}legendables(){const t=super.legendables();return this._dashStyle?t.map((t=>(t.dashstyle=this._dashStyle,t))):t}}const Bt=(t,e)=>new Ot(t,e),Ft="number-display";class Pt extends j{constructor(t,e){super(),this._formatNumber=s.format(".2s"),this._html={one:"",some:"",none:""},this._lastValue=void 0,this._ariaLiveRegion=!1,this._mandatoryAttributes(["group"]),this.ordering((t=>t.value)),this.data((t=>{const e=t.value?t.value():this._maxBin(t.all());return this.valueAccessor()(e)})),this.transitionDuration(250),this.transitionDelay(0),this.anchor(t,e)}html(t){return arguments.length?(t.none?this._html.none=t.none:t.one?this._html.none=t.one:t.some&&(this._html.none=t.some),t.one?this._html.one=t.one:t.some&&(this._html.one=t.some),t.some?this._html.some=t.some:t.one&&(this._html.some=t.one),this):this._html}value(){return this.data()}_maxBin(t){if(!t.length)return null;const e=this._computeOrderedGroups(t);return e[e.length-1]}_doRender(){const t=this.value();let e=this.selectAll("."+Ft);e.empty()&&(e=e.data([0]).enter().append("span").attr("class",Ft).classed("dc-tabbable",this._keyboardAccessible).merge(e),this._keyboardAccessible&&e.attr("tabindex","0"),this._ariaLiveRegion&&(this.transitionDuration(0),e.attr("aria-live","polite")));{const i=this;e.transition().duration(i.transitionDuration()).delay(i.transitionDelay()).ease(y.easeQuad).tween("text",(function(){const e=isFinite(i._lastValue)?i._lastValue:0,s=l.interpolateNumber(e||0,t);i._lastValue=t;const r=this;return e=>{let n=null;const a=i.formatNumber()(s(e));0===t&&""!==i._html.none?n=i._html.none:1===t&&""!==i._html.one?n=i._html.one:""!==i._html.some&&(n=i._html.some),r.innerHTML=n?n.replace("%number",a):a}}))}}_doRedraw(){return this._doRender()}formatNumber(t){return arguments.length?(this._formatNumber=t,this):this._formatNumber}ariaLiveRegion(t){return arguments.length?(this._ariaLiveRegion=t,this):this._ariaLiveRegion}}class Ht extends(J(K(j))){constructor(t,e){super(),this._sliceCssClass="pie-slice",this._labelCssClass="pie-label",this._sliceGroupCssClass="pie-slice-group",this._labelGroupCssClass="pie-label-group",this._emptyCssClass="empty-chart",this._emptyTitle="empty",this._radius=void 0,this._givenRadius=void 0,this._innerRadius=0,this._externalRadiusPadding=0,this._g=void 0,this._cx=void 0,this._cy=void 0,this._minAngleForLabel=.5,this._externalLabelRadius=void 0,this._drawPaths=!1,this.colorAccessor((t=>this.cappedKeyAccessor(t))),this.title((t=>`${this.cappedKeyAccessor(t)}: ${this.cappedValueAccessor(t)}`)),this.label((t=>this.cappedKeyAccessor(t))),this.renderLabel(!0),this.transitionDuration(350),this.transitionDelay(0),this.anchor(t,e)}slicesCap(t){return this.cap(t)}_doRender(){return this.resetSvg(),this._g=this.svg().append("g").attr("transform",`translate(${this.cx()},${this.cy()})`),this._g.append("g").attr("class",this._sliceGroupCssClass),this._g.append("g").attr("class",this._labelGroupCssClass),this._drawChart(),this}_drawChart(){const t=a.min([this.width(),this.height()])/2;this._radius=this._givenRadius&&this._givenRadius<t?this._givenRadius:t;const e=this._buildArcs(),i=this._pieLayout();let s;if(a.sum(this.data(),(t=>this.cappedValueAccessor(t)))?(s=i(this.data()),this._g.classed(this._emptyCssClass,!1)):(s=i([{key:this._emptyTitle,value:1,others:[this._emptyTitle]}]),this._g.classed(this._emptyCssClass,!0)),this._g){const t=this._g.select("g."+this._sliceGroupCssClass).selectAll("g."+this._sliceCssClass).data(s),i=this._g.select("g."+this._labelGroupCssClass).selectAll("text."+this._labelCssClass).data(s);this._removeElements(t,i),this._createElements(t,i,e,s),this._updateElements(s,e),this._highlightFilter(),F(this._g,this.transitionDuration(),this.transitionDelay()).attr("transform",`translate(${this.cx()},${this.cy()})`)}}_createElements(t,e,i,s){const r=this._createSliceNodes(t);this._createSlicePath(r,i),this._createTitles(r),this._createLabels(e,s,i)}_createSliceNodes(t){return t.enter().append("g").attr("class",((t,e)=>`${this._sliceCssClass} _${e}`)).classed("dc-tabbable",this._keyboardAccessible)}_createSlicePath(t,e){const i=t.append("path").attr("fill",((t,e)=>this._fill(t,e))).on("click",w.eventHandler((t=>this._onClick(t)))).attr("d",((t,i)=>this._safeArc(t,i,e)));this._keyboardAccessible&&this._makeKeyboardAccessible(this._onClick);const s=F(i,this.transitionDuration(),this.transitionDelay());if(s.attrTween){const t=this;s.attrTween("d",(function(e){return t._tweenPie(e,this)}))}}_createTitles(t){this.renderTitle()&&t.append("title").text((t=>this.title()(t.data)))}_applyLabelText(t){t.text((t=>{const e=t.data;return!this._sliceHasNoData(e)&&!this._sliceTooSmall(t)||this._isSelectedSlice(t)?this.label()(t.data):""}))}_positionLabels(t,e){this._applyLabelText(t),F(t,this.transitionDuration(),this.transitionDelay()).attr("transform",(t=>this._labelPosition(t,e))).attr("text-anchor","middle")}_highlightSlice(t,e){this.select("g.pie-slice._"+t).classed("highlight",e)}_createLabels(t,e,i){if(this.renderLabel()){const s=t.enter().append("text").attr("class",((t,e)=>{let i=`${this._sliceCssClass} ${this._labelCssClass} _${e}`;return this._externalLabelRadius&&(i+=" external"),i})).on("click",w.eventHandler((t=>this._onClick(t)))).on("mouseover",w.eventHandler((t=>{this._highlightSlice(t.index,!0)}))).on("mouseout",w.eventHandler((t=>{this._highlightSlice(t.index,!1)})));this._positionLabels(s,i),this._externalLabelRadius&&this._drawPaths&&this._updateLabelPaths(e,i)}}_updateLabelPaths(t,e){let i=this._g.selectAll("polyline."+this._sliceCssClass).data(t);i.exit().remove(),i=i.enter().append("polyline").attr("class",((t,e)=>`pie-path _${e} ${this._sliceCssClass}`)).on("click",w.eventHandler((t=>this._onClick(t)))).on("mouseover",w.eventHandler((t=>{this._highlightSlice(t.index,!0)}))).on("mouseout",w.eventHandler((t=>{this._highlightSlice(t.index,!1)}))).merge(i);const s=g.arc().outerRadius(this._radius-this._externalRadiusPadding+this._externalLabelRadius).innerRadius(this._radius-this._externalRadiusPadding),r=F(i,this.transitionDuration(),this.transitionDelay());r.attrTween?r.attrTween("points",(function(t){let i=this._current||t;i={startAngle:i.startAngle,endAngle:i.endAngle};const r=l.interpolate(i,t);return this._current=r(0),t=>{const i=r(t);return[e.centroid(i),s.centroid(i)]}})):r.attr("points",(t=>[e.centroid(t),s.centroid(t)])),r.style("visibility",(t=>t.endAngle-t.startAngle<1e-4?"hidden":"visible"))}_updateElements(t,e){this._updateSlicePaths(t,e),this._updateLabels(t,e),this._updateTitles(t)}_updateSlicePaths(t,e){const i=this._g.selectAll("g."+this._sliceCssClass).data(t).select("path").attr("d",((t,i)=>this._safeArc(t,i,e))),s=F(i,this.transitionDuration(),this.transitionDelay());if(s.attrTween){const t=this;s.attrTween("d",(function(e){return t._tweenPie(e,this)}))}s.attr("fill",((t,e)=>this._fill(t,e)))}_updateLabels(t,e){if(this.renderLabel()){const i=this._g.selectAll("text."+this._labelCssClass).data(t);this._positionLabels(i,e),this._externalLabelRadius&&this._drawPaths&&this._updateLabelPaths(t,e)}}_updateTitles(t){this.renderTitle()&&this._g.selectAll("g."+this._sliceCssClass).data(t).select("title").text((t=>this.title()(t.data)))}_removeElements(t,e){t.exit().remove(),e.exit().remove()}_highlightFilter(){const t=this;this.hasFilter()?this.selectAll("g."+this._sliceCssClass).each((function(e){t._isSelectedSlice(e)?t.highlightSelected(this):t.fadeDeselected(this)})):this.selectAll("g."+this._sliceCssClass).each((function(){t.resetHighlight(this)}))}externalRadiusPadding(t){return arguments.length?(this._externalRadiusPadding=t,this):this._externalRadiusPadding}innerRadius(t){return arguments.length?(this._innerRadius=t,this):this._innerRadius}radius(t){return arguments.length?(this._givenRadius=t,this):this._givenRadius}cx(t){return arguments.length?(this._cx=t,this):this._cx||this.width()/2}cy(t){return arguments.length?(this._cy=t,this):this._cy||this.height()/2}_buildArcs(){return g.arc().outerRadius(this._radius-this._externalRadiusPadding).innerRadius(this._innerRadius)}_isSelectedSlice(t){return this.hasFilter(this.cappedKeyAccessor(t.data))}_doRedraw(){return this._drawChart(),this}minAngleForLabel(t){return arguments.length?(this._minAngleForLabel=t,this):this._minAngleForLabel}_pieLayout(){return g.pie().sort(null).value((t=>this.cappedValueAccessor(t)))}_sliceTooSmall(t){const e=t.endAngle-t.startAngle;return isNaN(e)||e<this._minAngleForLabel}_sliceHasNoData(t){return 0===this.cappedValueAccessor(t)}_isOffCanvas(t){return!t||isNaN(t.startAngle)||isNaN(t.endAngle)}_fill(t,e){return this.getColor(t.data,e)}_onClick(t){this._g.attr("class")!==this._emptyCssClass&&this.onClick(t.data)}_safeArc(t,e,i){let s=i(t,e);return s.indexOf("NaN")>=0&&(s="M0,0"),s}emptyTitle(t){return 0===arguments.length?this._emptyTitle:(this._emptyTitle=t,this)}externalLabels(t){return 0===arguments.length?this._externalLabelRadius:(this._externalLabelRadius=t||void 0,this)}drawPaths(t){return 0===arguments.length?this._drawPaths:(this._drawPaths=t,this)}_labelPosition(t,e){let i;return i=this._externalLabelRadius?g.arc().outerRadius(this._radius-this._externalRadiusPadding+this._externalLabelRadius).innerRadius(this._radius-this._externalRadiusPadding+this._externalLabelRadius).centroid(t):e.centroid(t),isNaN(i[0])||isNaN(i[1])?"translate(0,0)":`translate(${i})`}legendables(){return this.data().map(((t,e)=>{const i={name:t.key,data:t.value,others:t.others,chart:this};return i.color=this.getColor(t,e),i}))}legendHighlight(t){this._highlightSliceFromLegendable(t,!0)}legendReset(t){this._highlightSliceFromLegendable(t,!1)}legendToggle(t){this.onClick({key:t.name,others:t.others})}_highlightSliceFromLegendable(t,e){this.selectAll("g.pie-slice").each((function(i){t.name===i.data.key&&r.select(this).classed("highlight",e)}))}_tweenPie(t,e){t.innerRadius=this._innerRadius;let i=e._current;i=this._isOffCanvas(i)?{startAngle:0,endAngle:0}:{startAngle:i.startAngle,endAngle:i.endAngle};const s=l.interpolate(i,t);return e._current=s(0),t=>this._safeArc(s(t),0,this._buildArcs())}}class Tt extends(J(K(Q))){constructor(t,e){super(),this._g=void 0,this._labelOffsetX=10,this._labelOffsetY=15,this._hasLabelOffsetY=!1,this._dyOffset="0.35em",this._titleLabelOffsetX=2,this._gap=5,this._fixedBarHeight=!1,this._rowCssClass="row",this._titleRowCssClass="titlerow",this._renderTitleLabel=!1,this._x=void 0,this._elasticX=void 0,this._xAxis=c.axisBottom(),this._rowData=void 0,this.rowsCap=this.cap,this.title((t=>`${this.cappedKeyAccessor(t)}: ${this.cappedValueAccessor(t)}`)),this.label((t=>this.cappedKeyAccessor(t))),this.anchor(t,e)}_calculateAxisScale(){if(!this._x||this._elasticX){const t=a.extent(this._rowData,(t=>this.cappedValueAccessor(t)));t[0]>0&&(t[0]=0),t[1]<0&&(t[1]=0),this._x=h.scaleLinear().domain(t).range([0,this.effectiveWidth()])}this._xAxis.scale(this._x)}_drawAxis(){let t=this._g.select("g.axis");this._calculateAxisScale(),t.empty()&&(t=this._g.append("g").attr("class","axis")),t.attr("transform",`translate(0, ${this.effectiveHeight()})`),F(t,this.transitionDuration(),this.transitionDelay()).call(this._xAxis)}_doRender(){return this.resetSvg(),this._g=this.svg().append("g").attr("transform",`translate(${this.margins().left},${this.margins().top})`),this._drawChart(),this}x(t){return arguments.length?(this._x=t,this):this._x}_drawGridLines(){this._g.selectAll("g.tick").select("line.grid-line").remove(),this._g.selectAll("g.tick").append("line").attr("class","grid-line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",(()=>-this.effectiveHeight()))}_drawChart(){this._rowData=this.data(),this._drawAxis(),this._drawGridLines();let t=this._g.selectAll("g."+this._rowCssClass).data(this._rowData);this._removeElements(t),t=this._createElements(t).merge(t),this._updateElements(t)}_createElements(t){const e=t.enter().append("g").attr("class",((t,e)=>`${this._rowCssClass} _${e}`));return e.append("rect").attr("width",0),this._createLabels(e),e}_removeElements(t){t.exit().remove()}_rootValue(){const t=this._x(0);return t===-1/0||t!=t?this._x(1):t}_updateElements(t){const e=this._rowData.length;let i;i=this._fixedBarHeight?this._fixedBarHeight:(this.effectiveHeight()-(e+1)*this._gap)/e,this._hasLabelOffsetY||(this._labelOffsetY=i/2);const s=t.attr("transform",((t,e)=>`translate(0,${(e+1)*this._gap+e*i})`)).select("rect").attr("height",i).attr("fill",this.getColor).on("click",w.eventHandler((t=>this._onClick(t)))).classed("dc-tabbable",this._keyboardAccessible).classed("deselected",(t=>!!this.hasFilter()&&!this._isSelectedRow(t))).classed("selected",(t=>!!this.hasFilter()&&this._isSelectedRow(t)));this._keyboardAccessible&&this._makeKeyboardAccessible((t=>this._onClick(t))),F(s,this.transitionDuration(),this.transitionDelay()).attr("width",(t=>Math.abs(this._rootValue()-this._x(this.cappedValueAccessor(t))))).attr("transform",(t=>this._translateX(t))),this._createTitles(t),this._updateLabels(t)}_createTitles(t){this.renderTitle()&&(t.select("title").remove(),t.append("title").text(this.title()))}_createLabels(t){this.renderLabel()&&t.append("text").on("click",w.eventHandler((t=>this._onClick(t)))),this.renderTitleLabel()&&t.append("text").attr("class",this._titleRowCssClass).on("click",w.eventHandler((t=>this._onClick(t))))}_updateLabels(t){if(this.renderLabel()){const e=t.select("text").attr("x",this._labelOffsetX).attr("y",this._labelOffsetY).attr("dy",this._dyOffset).on("click",w.eventHandler((t=>this._onClick(t)))).attr("class",((t,e)=>`${this._rowCssClass} _${e}`)).text((t=>this.label()(t)));F(e,this.transitionDuration(),this.transitionDelay()).attr("transform",(t=>this._translateX(t)))}if(this.renderTitleLabel()){const e=t.select("."+this._titleRowCssClass).attr("x",this.effectiveWidth()-this._titleLabelOffsetX).attr("y",this._labelOffsetY).attr("dy",this._dyOffset).attr("text-anchor","end").on("click",w.eventHandler((t=>this._onClick(t)))).attr("class",((t,e)=>`${this._titleRowCssClass} _${e}`)).text((t=>this.title()(t)));F(e,this.transitionDuration(),this.transitionDelay()).attr("transform",(t=>this._translateX(t)))}}renderTitleLabel(t){return arguments.length?(this._renderTitleLabel=t,this):this._renderTitleLabel}_onClick(t){this.onClick(t)}_translateX(t){const e=this._x(this.cappedValueAccessor(t)),i=this._rootValue();return`translate(${e>i?i:e},0)`}_doRedraw(){return this._drawChart(),this}xAxis(t){return arguments.length?(this._xAxis=t,this):this._xAxis}fixedBarHeight(t){return arguments.length?(this._fixedBarHeight=t,this):this._fixedBarHeight}gap(t){return arguments.length?(this._gap=t,this):this._gap}elasticX(t){return arguments.length?(this._elasticX=t,this):this._elasticX}labelOffsetX(t){return arguments.length?(this._labelOffsetX=t,this):this._labelOffsetX}labelOffsetY(t){return arguments.length?(this._labelOffsetY=t,this._hasLabelOffsetY=!0,this):this._labelOffsetY}titleLabelOffsetX(t){return arguments.length?(this._titleLabelOffsetX=t,this):this._titleLabelOffsetX}_isSelectedRow(t){return this.hasFilter(this.cappedKeyAccessor(t))}}class Et extends it{constructor(t,e){super(),this._symbol=g.symbol(),this._existenceAccessor=t=>t.value;const i=this.keyAccessor();this.keyAccessor((t=>i(t)[0])),this.valueAccessor((t=>i(t)[1])),this.colorAccessor((()=>this._groupName)),this.title((t=>`${this.keyAccessor()(t)},${this.valueAccessor()(t)}: ${this.existenceAccessor()(t)}`)),this._highlightedSize=7,this._symbolSize=5,this._excludedSize=3,this._excludedColor=null,this._excludedOpacity=1,this._emptySize=0,this._emptyOpacity=0,this._nonemptyOpacity=1,this._emptyColor=null,this._filtered=[],this._canvas=null,this._context=null,this._useCanvas=!1,this.brush(_.brush()),this._symbol.size(((t,e)=>this._elementSize(t,e))),this.anchor(t,e)}_canvasElementSize(t,e){return this._existenceAccessor(t)?e?this._symbolSize/Math.sqrt(Math.PI):this._excludedSize/Math.sqrt(Math.PI):this._emptySize/Math.sqrt(Math.PI)}_elementSize(t,e){return this._existenceAccessor(t)?this._filtered[e]?Math.pow(this._symbolSize,2):Math.pow(this._excludedSize,2):Math.pow(this._emptySize,2)}_locator(t){return`translate(${this.x()(this.keyAccessor()(t))},${this.y()(this.valueAccessor()(t))})`}filter(t){return arguments.length?super.filter(E.RangedTwoDimensionalFilter(t)):super.filter()}resetSvg(){if(this._useCanvas){super.resetSvg(),this.select("canvas").remove();const t=this.svg();this.root().style("position","relative"),t.style("position","relative");const e=isNaN(parseInt(t.style("left"),10))?0:parseInt(t.style("left"),10),i=isNaN(parseInt(t.style("top"),10))?0:parseInt(t.style("top"),10),s=this.effectiveWidth(),r=this.effectiveHeight(),n=this.margins(),a=window.devicePixelRatio||1;return this._canvas=this.root().append("canvas").attr("x",0).attr("y",0).attr("width",s*a).attr("height",r*a).style("width",s+"px").style("height",r+"px").style("position","absolute").style("top",n.top+i+"px").style("left",n.left+e+"px").style("z-index",-1).style("pointer-events","none"),this._context=this._canvas.node().getContext("2d"),this._context.scale(a,a),this._context.rect(0,0,s,r),this._context.clip(),this._context.imageSmoothingQuality="high",this.svg()}return super.resetSvg()}_resizeCanvas(){const t=this.effectiveWidth(),e=this.effectiveHeight(),i=window.devicePixelRatio||1;this._canvas.attr("width",t*i).attr("height",e*i).style("width",t+"px").style("height",e+"px"),this._context.scale(i,i)}useCanvas(t){return arguments.length?(this._useCanvas=t,this):this._useCanvas}canvas(t){return arguments.length?(this._canvas=t,this):this._canvas}context(){return this._context}_plotOnCanvas(t){this._resizeCanvas();const e=this.context();e.clearRect(0,0,1*(e.canvas.width+2),1*(e.canvas.height+2));this.data().forEach(((i,s)=>{const r=!this.filter()||this.filter().isFiltered([i.key[0],i.key[1]]);let n=1;n=this._existenceAccessor(i)?r?this._nonemptyOpacity:this.excludedOpacity():this._emptyOpacity;let a=null;a=this._emptyColor&&!this._existenceAccessor(i)?this._emptyColor:this.excludedColor()&&!r?this.excludedColor():this.getColor(i);let h=this._canvasElementSize(i,r);if(t){const e=a===t.color,i=.1;e||(n=i),e&&(h=this._highlightedSize/Math.sqrt(Math.PI))}e.save(),e.globalAlpha=n,e.beginPath(),e.arc(this.x()(this.keyAccessor()(i)),this.y()(this.valueAccessor()(i)),h,0,2*Math.PI,!0),e.fillStyle=a,e.fill(),e.restore()}))}_plotOnSVG(){const t=this.data();this._keyboardAccessible&&t.sort(((t,e)=>a.ascending(this.keyAccessor()(t),this.keyAccessor()(e))));let e=this.chartBodyG().selectAll("path.symbol").data(t);F(e.exit(),this.transitionDuration(),this.transitionDelay()).attr("opacity",0).remove(),e=e.enter().append("path").attr("class","symbol").classed("dc-tabbable",this._keyboardAccessible).attr("opacity",0).attr("fill",this.getColor).attr("transform",(t=>this._locator(t))).merge(e),this._keyboardAccessible&&(this._makeKeyboardAccessible(),e.order()),e.call((e=>this._renderTitles(e,t))),e.each(((t,e)=>{this._filtered[e]=!this.filter()||this.filter().isFiltered([this.keyAccessor()(t),this.valueAccessor()(t)])})),F(e,this.transitionDuration(),this.transitionDelay()).attr("opacity",((t,e)=>this._existenceAccessor(t)?this._filtered[e]?this._nonemptyOpacity:this.excludedOpacity():this._emptyOpacity)).attr("fill",((t,e)=>this._emptyColor&&!this._existenceAccessor(t)?this._emptyColor:this.excludedColor()&&!this._filtered[e]?this.excludedColor():this.getColor(t))).attr("transform",(t=>this._locator(t))).attr("d",this._symbol)}plotData(){this._useCanvas?this._plotOnCanvas():this._plotOnSVG()}_renderTitles(t,e){this.renderTitle()&&(t.selectAll("title").remove(),t.append("title").text((t=>this.title()(t))))}existenceAccessor(t){return arguments.length?(this._existenceAccessor=t,this):this._existenceAccessor}symbol(t){return arguments.length?(this._symbol.type(t),this):this._symbol.type()}customSymbol(t){return arguments.length?(this._symbol=t,this._symbol.size(((t,e)=>this._elementSize(t,e))),this):this._symbol}symbolSize(t){return arguments.length?(this._symbolSize=t,this):this._symbolSize}highlightedSize(t){return arguments.length?(this._highlightedSize=t,this):this._highlightedSize}excludedSize(t){return arguments.length?(this._excludedSize=t,this):this._excludedSize}excludedColor(t){return arguments.length?(this._excludedColor=t,this):this._excludedColor}excludedOpacity(t){return arguments.length?(this._excludedOpacity=t,this):this._excludedOpacity}emptySize(t){return arguments.length?(this._emptySize=t,this):this._emptySize}hiddenSize(t){return arguments.length?this.emptySize(t):this.emptySize()}emptyColor(t){return arguments.length?(this._emptyColor=t,this):this._emptyColor}emptyOpacity(t){return arguments.length?(this._emptyOpacity=t,this):this._emptyOpacity}nonemptyOpacity(t){return arguments.length?(this._nonemptyOpacity=t,this):this._emptyOpacity}legendables(){return[{chart:this,name:this._groupName,color:this.getColor()}]}legendHighlight(t){this._useCanvas?this._plotOnCanvas(t):(this._resizeSymbolsWhere((e=>e.attr("fill")===t.color),this._highlightedSize),this.chartBodyG().selectAll(".chart-body path.symbol").filter((function(){return r.select(this).attr("fill")!==t.color})).classed("fadeout",!0))}legendReset(t){this._useCanvas?this._plotOnCanvas(t):(this._resizeSymbolsWhere((e=>e.attr("fill")===t.color),this._symbolSize),this.chartBodyG().selectAll(".chart-body path.symbol").filter((function(){return r.select(this).attr("fill")!==t.color})).classed("fadeout",!1))}_resizeSymbolsWhere(t,e){const i=this.chartBodyG().selectAll(".chart-body path.symbol").filter((function(){return t(r.select(this))})),s=this._symbol.size();this._symbol.size(Math.pow(e,2)),F(i,this.transitionDuration(),this.transitionDelay()).attr("d",this._symbol),this._symbol.size(s)}createBrushHandlePaths(){}extendBrush(t){return this.round()&&(t[0]=t[0].map(this.round()),t[1]=t[1].map(this.round())),t}brushIsEmpty(t){return!t||t[0][0]>=t[1][0]||t[0][1]>=t[1][1]}_brushing(t){if(this._ignoreBrushEvents)return;let e=t.selection,i=this.brushIsEmpty(e);e&&(e=e.map((t=>t.map(((t,e)=>(0===e?this.x():this.y()).invert(t))))),e=this.extendBrush(e),i=i&&this.brushIsEmpty(e)),this.redrawBrush(e,!1);const s=i?null:E.RangedTwoDimensionalFilter(e);T.trigger((()=>{this.replaceFilter(s),this.redrawGroup()}),A.EVENT_DELAY)}redrawBrush(t,e){if(this._gBrush=this.gBrush(),this.brushOn()&&this._gBrush)if(this.resizing()&&this.setBrushExtents(e),t){t=t.map((t=>t.map(((t,e)=>(0===e?this.x():this.y())(t)))));const i=P(e,this.transitionDuration(),this.transitionDelay())(this._gBrush);this._withoutBrushEvents((()=>{i.call(this.brush().move,t)}))}else this._withoutBrushEvents((()=>{this._gBrush.call(this.brush().move,t)}));this.fadeDeselectedArea(t)}}const zt="dc-select-option";class Mt extends j{constructor(t,e){super(),this._select=void 0,this._promptText="Select all",this._multiple=!1,this._promptValue=null,this._numberVisible=null,this.data((t=>t.all().filter(this._filterDisplayed))),this._filterDisplayed=t=>this.valueAccessor()(t)>0,this._order=(t,e)=>this.keyAccessor()(t)>this.keyAccessor()(e)?1:this.keyAccessor()(t)<this.keyAccessor()(e)?-1:0,this.anchor(t,e)}_doRender(){return this.select("select").remove(),this._select=this.root().append("select").classed("dc-select-menu",!0),this._select.append("option").text(this._promptText).attr("value",""),this._doRedraw(),this}_doRedraw(){return this._setAttributes(),this._renderOptions(),this.hasFilter()&&this._multiple?this._select.selectAll("option").property("selected",(t=>void 0!==t&&this.filters().indexOf(String(this.keyAccessor()(t)))>=0)):this.hasFilter()?this._select.property("value",this.filter()):this._select.property("value",""),this}_renderOptions(){const t=this._select.selectAll("option.dc-select-option").data(this.data(),(t=>this.keyAccessor()(t)));t.exit().remove(),t.enter().append("option").classed(zt,!0).attr("value",(t=>this.keyAccessor()(t))).merge(t).text(this.title()),this._select.selectAll("option.dc-select-option").sort(this._order),this._select.on("change",w.eventHandler(((t,e)=>this._onChange(t,e))))}_onChange(t,e){let i;const s=e.target;if(s.selectedOptions){i=Array.prototype.slice.call(s.selectedOptions).map((t=>t.value))}else{i=[].slice.call(e.target.options).filter((t=>t.selected)).map((t=>t.value))}1===i.length&&""===i[0]?i=this._promptValue||null:this._multiple||1!==i.length||(i=i[0]),this.onChange(i)}onChange(t){t&&this._multiple?this.replaceFilter([t]):t?this.replaceFilter(t):this.filterAll(),T.trigger((()=>{this.redrawGroup()}))}_setAttributes(){this._multiple?this._select.attr("multiple",!0):this._select.attr("multiple",null),null!==this._numberVisible?this._select.attr("size",this._numberVisible):this._select.attr("size",null)}order(t){return arguments.length?(this._order=t,this):this._order}promptText(t){return arguments.length?(this._promptText=t,this):this._promptText}filterDisplayed(t){return arguments.length?(this._filterDisplayed=t,this):this._filterDisplayed}multiple(t){return arguments.length?(this._multiple=t,this):this._multiple}promptValue(t){return arguments.length?(this._promptValue=t,this):this._promptValue}numberVisible(t){return arguments.length?(this._numberVisible=t,this):this._numberVisible}size(t){return C.warnOnce("selectMenu.size is ambiguous - use selectMenu.numberVisible instead"),arguments.length?this.numberVisible(t):this.numberVisible()}}class Nt extends yt{constructor(t,e){super(t,e),this._keySort=(t,e)=>a.ascending(this.keyAccessor()(t),this.keyAccessor()(e)),this._charts={},this._chartFunction=Bt,this._chartGroup=e,this._seriesAccessor=void 0,this._seriesSort=a.ascending,this._valueSort=this._keySort,this._mandatoryAttributes().push("seriesAccessor","chart"),this.shareColors(!0)}_compose(t){super.compose(t)}compose(t){throw new Error("Not supported for this chart type")}_preprocessData(){const t=[];let e;const i=w.nester({key:this._seriesAccessor,sortKeys:this._seriesSort,sortValues:this._valueSort,entries:this.data()}).map(((i,s)=>{const r=this._charts[i.key]||this._chartFunction(this,this._chartGroup,i.key,s);return this._charts[i.key]||(e=!0),this._charts[i.key]=r,t.push(i.key),r.dimension(this.dimension()).group({all:"function"==typeof i.values?i.values:N.constant(i.values)},i.key).keyAccessor(this.keyAccessor()).valueAccessor(this.valueAccessor()).brushOn(!1)}));Object.keys(this._charts).filter((e=>-1===t.indexOf(e))).forEach((t=>{this._clearChart(t),e=!0})),this._compose(i),e&&this.legend()&&this.legend().render()}_clearChart(t){this._charts[t].g()&&this._charts[t].g().remove(),delete this._charts[t]}_resetChildren(){Object.keys(this._charts).map(this._clearChart.bind(this)),this._charts={}}chart(t){return arguments.length?(this._chartFunction=t,this._resetChildren(),this):this._chartFunction}seriesAccessor(t){return arguments.length?(this._seriesAccessor=t,this._resetChildren(),this):this._seriesAccessor}seriesSort(t){return arguments.length?(this._seriesSort=t,this._resetChildren(),this):this._seriesSort}valueSort(t){return arguments.length?(this._valueSort=t,this._resetChildren(),this):this._valueSort}}class Gt extends(K(j)){constructor(t,e){super(),this._sliceCssClass="pie-slice",this._emptyCssClass="empty-chart",this._emptyTitle="empty",this._radius=void 0,this._givenRadius=void 0,this._innerRadius=0,this._ringSizes=null,this._g=void 0,this._cx=void 0,this._cy=void 0,this._minAngleForLabel=.5,this._externalLabelRadius=void 0,this.colorAccessor((t=>this.keyAccessor()(t))),this.ordering(M("key")),this.title((t=>`${this.keyAccessor()(t)}: ${this._extendedValueAccessor(t)}`)),this.label((t=>this.keyAccessor()(t))),this.renderLabel(!0),this.transitionDuration(350),this.anchor(t,e)}_extendedValueAccessor(t){return t.path?t.value:this.valueAccessor()(t)}_scaleRadius(t,e){if(0===t)return this._innerRadius;{const i=a.sum(this.ringSizes().relativeRingSizes.slice(0,t)),s=t*(1/this.ringSizes().relativeRingSizes.length)/i,r=(e-this.ringSizes().rootOffset)/(1-this.ringSizes().rootOffset)*(this._radius-this._innerRadius);return this._innerRadius+r/s}}_doRender(){return this.resetSvg(),this._g=this.svg().append("g").attr("transform",`translate(${this.cx()},${this.cy()})`),this._drawChart(),this}_drawChart(){const t=a.min([this.width(),this.height()])/2;this._radius=this._givenRadius&&this._givenRadius<t?this._givenRadius:t;const e=this._buildArcs();let i,s;if(a.sum(this.data(),this.valueAccessor())?(s=N.toHierarchy(this.data(),this.valueAccessor()),i=this._partitionNodes(s),i.nodes.shift(),this._g.classed(this._emptyCssClass,!1)):(s=N.toHierarchy([],(t=>t.value)),i=this._partitionNodes(s),this._g.classed(this._emptyCssClass,!0)),this.ringSizes().rootOffset=i.rootOffset,this.ringSizes().relativeRingSizes=i.relativeRingSizes,this._g){const t=this._g.selectAll("g."+this._sliceCssClass).data(i.nodes);this._createElements(t,e,i.nodes),this._updateElements(i.nodes,e),this._removeElements(t),this._highlightFilter(),F(this._g,this.transitionDuration(),this.transitionDelay()).attr("transform",`translate(${this.cx()},${this.cy()})`)}}_createElements(t,e,i){const s=this._createSliceNodes(t);this._createSlicePath(s,e),this._createTitles(s),this._createLabels(i,e)}_createSliceNodes(t){return t.enter().append("g").attr("class",((t,e)=>`${this._sliceCssClass} _${e} ${this._sliceCssClass}-level-${t.depth}`))}_createSlicePath(t,e){const i=t.append("path").attr("fill",((t,e)=>this._fill(t,e))).on("click",w.eventHandler((t=>this.onClick(t)))).classed("dc-tabbable",this._keyboardAccessible).attr("d",(t=>this._safeArc(e,t)));this._keyboardAccessible&&this._makeKeyboardAccessible(this.onClick);const s=F(i,this.transitionDuration());if(s.attrTween){const t=this;s.attrTween("d",(function(e){return t._tweenSlice(e,this)}))}}_createTitles(t){this.renderTitle()&&t.append("title").text((t=>this.title()(t)))}_positionLabels(t,e){F(t,this.transitionDuration()).attr("transform",(t=>this._labelPosition(t,e))).attr("text-anchor","middle").text((t=>this._sliceHasNoData(t)||this._sliceTooSmall(t)?"":this.label()(t)))}_createLabels(t,e){if(this.renderLabel()){const i=this._g.selectAll("text."+this._sliceCssClass).data(t);i.exit().remove();const s=i.enter().append("text").attr("class",((t,e)=>{let i=`${this._sliceCssClass} _${e}`;return this._externalLabelRadius&&(i+=" external"),i})).on("click",w.eventHandler((t=>this.onClick(t))));this._positionLabels(s,e)}}_updateElements(t,e){this._updateSlicePaths(t,e),this._updateLabels(t,e),this._updateTitles(t)}_updateSlicePaths(t,e){const i=this._g.selectAll("g."+this._sliceCssClass).data(t).select("path").attr("d",((t,i)=>this._safeArc(e,t))),s=F(i,this.transitionDuration());if(s.attrTween){const t=this;s.attrTween("d",(function(e){return t._tweenSlice(e,this)}))}s.attr("fill",((t,e)=>this._fill(t,e)))}_updateLabels(t,e){if(this.renderLabel()){const i=this._g.selectAll("text."+this._sliceCssClass).data(t);this._positionLabels(i,e)}}_updateTitles(t){this.renderTitle()&&this._g.selectAll("g."+this._sliceCssClass).data(t).select("title").text((t=>this.title()(t)))}_removeElements(t){t.exit().remove()}_highlightFilter(){const t=this;t.hasFilter()?t.selectAll("g."+t._sliceCssClass).each((function(e){t._isSelectedSlice(e)?t.highlightSelected(this):t.fadeDeselected(this)})):t.selectAll("g."+t._sliceCssClass).each((function(e){t.resetHighlight(this)}))}innerRadius(t){return arguments.length?(this._innerRadius=t,this):this._innerRadius}radius(t){return arguments.length?(this._givenRadius=t,this):this._givenRadius}cx(t){return arguments.length?(this._cx=t,this):this._cx||this.width()/2}cy(t){return arguments.length?(this._cy=t,this):this._cy||this.height()/2}minAngleForLabel(t){return arguments.length?(this._minAngleForLabel=t,this):this._minAngleForLabel}emptyTitle(t){return 0===arguments.length?this._emptyTitle:(this._emptyTitle=t,this)}externalLabels(t){return 0===arguments.length?this._externalLabelRadius:(this._externalLabelRadius=t||void 0,this)}defaultRingSizes(){return{partitionDy:()=>this._radius*this._radius,scaleInnerRadius:t=>t.data.path&&1===t.data.path.length?this._innerRadius:Math.sqrt(t.y0),scaleOuterRadius:t=>Math.sqrt(t.y1),relativeRingSizesFunction:()=>[]}}equalRingSizes(){return this.relativeRingSizes((t=>{const e=[];for(let i=0;i<t;i++)e.push(1/t);return e}))}relativeRingSizes(t){return{partitionDy:()=>1,scaleInnerRadius:t=>this._scaleRadius(t.data.path.length-1,t.y0),scaleOuterRadius:t=>this._scaleRadius(t.data.path.length,t.y1),relativeRingSizesFunction:e=>{const i=t(e);return function(t,e){if(!Array.isArray(t))throw new b("relativeRingSizes function must return an array");const i=a.sum(t);if(Math.abs(i-1)>A.NEGLIGIBLE_NUMBER)throw new b("relativeRingSizes : portions must add up to 1, but sum was "+i);if(t.length!==e)throw new b(`relativeRingSizes : number of values must match number of rings (${e}) but was ${t.length}`)}(i,e),i}}}ringSizes(t){return arguments.length?(this._ringSizes=t,this):(this._ringSizes||(this._ringSizes=this.defaultRingSizes()),this._ringSizes)}_buildArcs(){return g.arc().startAngle((t=>t.x0)).endAngle((t=>t.x1)).innerRadius((t=>this.ringSizes().scaleInnerRadius(t))).outerRadius((t=>this.ringSizes().scaleOuterRadius(t)))}_isSelectedSlice(t){return this._isPathFiltered(t.path)}_isPathFiltered(t){for(let e=0;e<this.filters().length;e++){if(this.filters()[e].isFiltered(t))return!0}return!1}_filtersForPath(t){const e=E.HierarchyFilter(t),i=[];for(let s=0;s<this.filters().length;s++){const r=this.filters()[s];(r.isFiltered(t)||e.isFiltered(r))&&i.push(r)}return i}_doRedraw(){return this._drawChart(),this}_partitionNodes(t){const e=function(t){return{key:t.data.key,value:t.value}},i=m.hierarchy(t).sum((t=>t.children?0:this._extendedValueAccessor(t))).sort(((t,i)=>a.ascending(this.ordering()(e(t)),this.ordering()(e(i)))));m.partition().size([2*Math.PI,this.ringSizes().partitionDy()])(i);const s=i.descendants().map((t=>(t.key=t.data.key,t.path=t.data.path,t))),r=this.ringSizes().relativeRingSizesFunction(i.height);return{nodes:s,rootOffset:i.y1,relativeRingSizes:r}}_sliceTooSmall(t){const e=t.x1-t.x0;return isNaN(e)||e<this._minAngleForLabel}_sliceHasNoData(t){return 0===this._extendedValueAccessor(t)}_isOffCanvas(t){return!t||isNaN(t.x0)||isNaN(t.y0)}_fill(t,e){return this.getColor(t.data,e)}onClick(t){if(this._g.attr("class")===this._emptyCssClass)return;const e=t.path||t.key,i=E.HierarchyFilter(e),s=this._filtersForPath(e);let r=!1;for(let t=s.length-1;t>=0;t--){const i=s[t];N.arraysIdentical(i,e)&&(r=!0),this.filter(s[t])}T.trigger((()=>{r||this.filter(i),this.redrawGroup()}))}_safeArc(t,e){let i=t(e);return i.indexOf("NaN")>=0&&(i="M0,0"),i}_labelPosition(t,e){let i;return i=this._externalLabelRadius?g.arc().outerRadius(this._radius+this._externalLabelRadius).innerRadius(this._radius+this._externalLabelRadius).centroid(t):e.centroid(t),isNaN(i[0])||isNaN(i[1])?"translate(0,0)":`translate(${i})`}legendables(){return this.data().map(((t,e)=>{const i={name:t.key,data:t.value,others:t.others,chart:this};return i.color=this.getColor(t,e),i}))}legendHighlight(t){this._highlightSliceFromLegendable(t,!0)}legendReset(t){this._highlightSliceFromLegendable(t,!1)}legendToggle(t){this.onClick({key:t.name,others:t.others})}_highlightSliceFromLegendable(t,e){this.selectAll("g.pie-slice").each((function(i){t.name===i.key&&r.select(this).classed("highlight",e)}))}_tweenSlice(t,e){let i=e._current;this._isOffCanvas(i)&&(i={x0:0,x1:0,y0:0,y1:0});const s={x0:t.x0,x1:t.x1,y0:t.y0,y1:t.y1},r=l.interpolate(i,s);return e._current=r(0),e=>this._safeArc(this._buildArcs(),Object.assign({},t,r(e)))}}class $t extends j{constructor(t,e){super(),this._normalize=t=>t.toLowerCase(),this._filterFunctionFactory=t=>(t=this._normalize(t),e=>-1!==this._normalize(e).indexOf(t)),this._placeHolder="search",this.group((()=>{throw"the group function on textFilterWidget should never be called, please report the issue"})),this.anchor(t,e)}_doRender(){this.select("input").remove(),this._input=this.root().append("input").classed("dc-text-filter-input",!0);const t=this;return this._input.on("input",(function(){t.dimension().filterFunction(t._filterFunctionFactory(this.value)),T.trigger((()=>{t.redrawGroup()}),A.EVENT_DELAY)})),this._doRedraw(),this}_doRedraw(){return this.root().selectAll("input").attr("placeholder",this._placeHolder),this}normalize(t){return arguments.length?(this._normalize=t,this):this._normalize}placeHolder(t){return arguments.length?(this._placeHolder=t,this):this._placeHolder}filterFunctionFactory(t){return arguments.length?(this._filterFunctionFactory=t,this):this._filterFunctionFactory}}+x.version[0]<6&&Object.assign(w,{eventHandler:t=>function(e,i){t.call(this,e,r.event)},callHandler:function(t,e,i,s){t.call(e,s)},nester:({key:t,sortKeys:e,sortValues:i,entries:s})=>{const r=f.nest().key(t);return e&&r.sortKeys(e),i&&r.sortValues(i),r.entries(s)},pointer:(t,e)=>r.mouse(e)});+x.version[0]>5&&Object.assign(w,{eventHandler:t=>function(e,i){t.call(this,i,e)},callHandler:function(t,e,i,s){t.call(e,i,s)},nester:({key:t,sortKeys:e,sortValues:i,entries:s})=>{i&&(s=[...s].sort(i));let r=a.groups(s,t);return e&&(r=r.sort(e)),r.map((t=>({key:""+t[0],values:t[1]})))},pointer:r.pointer}),t.BadArgumentException=b,t.BarChart=ht,t.BaseMixin=j,t.BoxPlot=ot,t.BubbleChart=ct,t.BubbleMixin=Z,t.BubbleOverlay=ut,t.CapMixin=J,t.CboxMenu=pt,t.ColorMixin=K,t.CompositeChart=yt,t.Config=k,t.CoordinateGridMixin=it,t.DataCount=mt,t.DataGrid=bt,t.DataTable=vt,t.GeoChoroplethChart=Ct,t.HeatMap=kt,t.HtmlLegend=St,t.InvalidStateException=z,t.Legend=wt,t.LineChart=Ot,t.Logger=v,t.MarginMixin=Q,t.NumberDisplay=Pt,t.PieChart=Ht,t.RowChart=Tt,t.ScatterPlot=Et,t.SelectMenu=Mt,t.SeriesChart=Nt,t.StackMixin=at,t.SunburstChart=Gt,t.TextFilterWidget=$t,t.afterTransition=function(t,e){if(t.empty()||!t.duration)e.call(t);else{let i=0;t.each((()=>{++i})).on("end",(()=>{--i||e.call(t)}))}},t.barChart=(t,e)=>new ht(t,e),t.baseMixin=()=>new j,t.boxPlot=(t,e)=>new ot(t,e),t.bubbleChart=(t,e)=>new ct(t,e),t.bubbleOverlay=(t,e)=>new ut(t,e),t.cboxMenu=(t,e)=>new pt(t,e),t.chartRegistry=L,t.compositeChart=(t,e)=>new yt(t,e),t.config=S,t.constants=A,t.d3Box=st,t.d3compat=w,t.dataCount=(t,e)=>new mt(t,e),t.dataGrid=(t,e)=>new bt(t,e),t.dataTable=(t,e)=>new vt(t,e),t.deregisterAllCharts=function(t){L.clear(t)},t.deregisterChart=D,t.events=T,t.filterAll=function(t){const e=L.list(t);for(let t=0;t<e.length;++t)e[t].filterAll()},t.filters=E,t.geoChoroplethChart=(t,e)=>new Ct(t,e),t.hasChart=function(t){return L.has(t)},t.heatMap=(t,e)=>new kt(t,e),t.htmlLegend=()=>new St,t.instanceOfChart=H,t.legend=()=>new wt,t.lineChart=Bt,t.logger=C,t.numberDisplay=(t,e)=>new Pt(t,e),t.optionalTransition=P,t.pieChart=(t,e)=>new Ht(t,e),t.pluck=M,t.printers=Y,t.redrawAll=B,t.refocusAll=function(t){const e=L.list(t);for(let t=0;t<e.length;++t)e[t].focus&&e[t].focus()},t.registerChart=R,t.renderAll=O,t.renderlet=function(t){return arguments.length?(S._renderlet=t,null):S._renderlet},t.rowChart=(t,e)=>new Tt(t,e),t.scatterPlot=(t,e)=>new Et(t,e),t.selectMenu=(t,e)=>new Mt(t,e),t.seriesChart=(t,e)=>new Nt(t,e),t.sunburstChart=(t,e)=>new Gt(t,e),t.textFilterWidget=(t,e)=>new $t(t,e),t.transition=F,t.units=V,t.utils=N,t.version="4.2.7",Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=dc.min.js.map
